
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>11. Pionix BelayBox &#8212; EVerest  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxdoc.css" />
    <link rel="stylesheet" type="text/css" href="../_static/contentui.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/contentui.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="12. Snapshot" href="../appendix/02_snapshot.html" />
    <link rel="prev" title="10. Frequently Asked Questions And Best Practices" href="../general/faq.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../appendix/02_snapshot.html" title="12. Snapshot"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../general/faq.html" title="10. Frequently Asked Questions And Best Practices"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">EVerest  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">11. </span>Pionix BelayBox</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="pionix-belaybox">
<h1><span class="section-number">11. </span>Pionix BelayBox<a class="headerlink" href="#pionix-belaybox" title="Permalink to this heading">¶</a></h1>
<section id="introduction">
<h2><span class="section-number">11.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>The BelayBox is a reference platform specifically designed for development and
testing of the open source software EVerest. More details about how EVerest is
embedded on the hardware can be found in the dedicated sections about EVerest
cross-compilation in the section “BelayBox use cases”.</p>
<p>The BelayBox is delivered as a development kit, which has to be assembled
following the instructions in this documentation. Part of the kit is a
Raspberry Pi CM4 compute module. PIONIX is officially part of the “Powered by
Raspberry Pi” scheme:</p>
<a class="reference internal image-reference" href="../_images/powered-by-pi.png"><img alt="Logo Powered by Raspberry Pi for Charging Development Kit BelayBox" class="align-center" src="../_images/powered-by-pi.png" style="width: 300px;" /></a>
<p>BelayBox can be utilized by individuals, research facilities and companies
alike to</p>
<ul class="simple">
<li><p>parallelize HW and SW developments for new charger projects,</p></li>
<li><p>explore new charging algorithms without the need do all the groundwork,</p></li>
<li><p>rapid integration of EV charging with other applications</p></li>
</ul>
<p>and anything else you want to quickly do without building your own EVerest
compatible charger first.</p>
<p>The BelayBox is not meant to be used for private usage or outdoor charging.</p>
<section id="the-belaybox-hardware">
<h3><span class="section-number">11.1.1. </span>The BelayBox hardware<a class="headerlink" href="#the-belaybox-hardware" title="Permalink to this heading">¶</a></h3>
<p>The BelayBox consists mainly of the Yeti board - an AC charger for
electric vehicles (EV) supporting IEC-61851-1 and SAE J1772 - and the Yak
board, which is a high-level control board for EV charging stations supporting
ISO 15118-2 (with ISO 15118-20 on its way) and DIN SPEC70121.</p>
<p>As both - Yeti and Yak board - are released as Open Hardware under CERN
Open Hardware Licence Version 2 (Permissive), we are very happy to point you
to the schematics and design files and also the firmware:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/PionixPublic/reference-hardware">Yeti and Yak Hardware Reference Design</a></p></li>
<li><p><a class="reference external" href="https://github.com/PionixPublic/yeti-firmware">Yeti Firmware</a></p></li>
</ul>
<p>The 3D files of the BelayBox case components can be downloaded here:
<a class="reference external" href="https://a360.co/45erK90">BelayBox 3D files</a>.</p>
<p>For more information about vendors working with EVerest,
contact us via
the <a class="reference external" href="https://lists.lfenergy.org/g/everest">EVerest mailing list</a>.</p>
</section>
<section id="getting-support">
<h3><span class="section-number">11.1.2. </span>Getting support<a class="headerlink" href="#getting-support" title="Permalink to this heading">¶</a></h3>
<p>See also the <a class="reference external" href="https://pionix.com/user-manual-belaybox">BelayBox manual</a>.</p>
<p>If you already have purchased a BelayBox kit and you have hardware related
questions, you can get support by creating an issue via our
<a class="reference external" href="http://support.pionix.com">support page</a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This is only for hardware-related support. For all software-related
questions, you can find help in the wonderful EVerest community via
<a class="reference external" href="https://lfenergy.zulipchat.com/">Zulip</a> or the
<a class="reference external" href="https://lists.lfenergy.org/g/everest">EVerest mailinglist</a>.</p>
</div>
<p>If you need additional parts for your BelayBox, see the
<a class="reference external" href="https://shop.pionix.com">Pionix Online Shop</a>.</p>
</section>
</section>
<section id="setting-up-hardware-and-software">
<h2><span class="section-number">11.2. </span>Setting up Hardware and Software<a class="headerlink" href="#setting-up-hardware-and-software" title="Permalink to this heading">¶</a></h2>
<p>The Yeti board is delivered with a firmware already flashed on it.
The Yak board does not have any software flashed on it.</p>
<p>In the following sections, we will show how to assemble the hardware parts and
also how to do the flashing of the Yak board. The Yocto image for the Yak
board includes binaries and services to run Basecamp - the commercial grade
version of EVerest - as a demo.</p>
<p>BaseCamp is a professional and stable wrapper around the open-source charging
software EVerest. For more information about the product of BaseCamp, see
<a class="reference external" href="https://www.pionix.com/products/basecamp">this BaseCamp page</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In case you need to build a custom Yeti firmware, have a look at this repo:
<a class="reference external" href="https://github.com/PionixPublic/yeti-firmware">Yeti firmware GitHub repository here</a>
. Also see the
<a class="reference internal" href="#belaybox-yeti-flash"><span class="std std-ref">section about how to flash the Yeti board</span></a>.</p>
</div>
<section id="assembling-the-yak-board">
<h3><span class="section-number">11.2.1. </span>Assembling the Yak Board<a class="headerlink" href="#assembling-the-yak-board" title="Permalink to this heading">¶</a></h3>
<p>Starting assembling the Yak Board, you should have the following parts
available:</p>
<img alt="../_images/yak-assembly-1-overview-w600.png" src="../_images/yak-assembly-1-overview-w600.png" />
<p>And you will need the following tools:</p>
<ul class="simple">
<li><p>ESD safe environment, e.g. ESD wrist band</p></li>
<li><p>ESD underlay mat</p></li>
<li><p>Linux host system, Ubuntu &gt;18 recommended</p></li>
<li><p>1x Micro USB cable</p></li>
<li><p>12 V DC power supply with minimum 30 W to connect to “12 V IN” pins on
Yak board. A lab power supply is sufficient.</p></li>
</ul>
<p>Needed software:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/raspberrypi/usbboot/blob/master/Readme.md#building">Raspberry PI USB Boot</a></p></li>
<li><p>bmaptool - <a class="reference external" href="https://docs.yoctoproject.org/dev-manual/bmaptool.html">see here</a></p></li>
<li><p>Internet access from host system</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Before working with any open PCB make sure to work in an ESD safe
environment using ESD safe equipment only.</p>
</div>
<p>Glue on the heatsinks as shown in the following image using the double
sided tape that comes with the heatsinks. Plug in the small clips into
the mounting holes of the CM4 board as shown.</p>
<img alt="../_images/yak-assembly-2-w500.png" src="../_images/yak-assembly-2-w500.png" />
<p>Turn around the CM4 and put on the gray spacers as shown here:</p>
<img alt="../_images/yak-assembly-3-w500.png" src="../_images/yak-assembly-3-w500.png" />
<p>Plug the CM4 board in both connectors and make sure the clips go all the way
through the Yak board and hold the CM4 securely without any gaps between the
spacers and both boards. Make sure to remove the metal part (if there is one)
out of the board-to-board connector as shown in the upper left corner in the
following image:</p>
<img alt="../_images/yak-assembly-4-w600.png" src="../_images/yak-assembly-4-w600.png" />
<p>This is how it looks from the top side:</p>
<img alt="../_images/yak-assembly-5-w600.png" src="../_images/yak-assembly-5-w600.png" />
<p>Now place the small black jumper onto the “BOOT” pins as shown above. This
is needed to be able to make the emmC flash accessible to the host system.</p>
</section>
<section id="flashing-the-yak-board">
<h3><span class="section-number">11.2.2. </span>Flashing the Yak Board<a class="headerlink" href="#flashing-the-yak-board" title="Permalink to this heading">¶</a></h3>
<p>In this section, we will walk you through the process of deploying the
Yocto-based image including EVerest in form of BaseCamp.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You will only have to do this flashing procedure once. After that, you can
use the RAUC updates, which are hosted on PIONIX update servers.
In case you need to reflash the whole image, we will inform you in the
public support channels.</p>
<p>If you want to create your own custom yocto image with EVerest, you can
have a look at
<a class="reference external" href="https://github.com/PionixPublic/yeti-yak-sdk">Yeti-Yak-SDK repository</a>.</p>
</div>
<p>Now to the steps to flash the board:</p>
<ol class="arabic simple">
<li><p>Download the latest stable image and the matching .bmap file:</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p><a class="reference external" href="https://pionix-update.de/belaybox-basecamp-demo/stable/belaybox-image-raspberrypi4-20240912100805.rootfs.wic.bz2">https://pionix-update.de/belaybox-basecamp-demo/stable/belaybox-image-raspberrypi4-20240912100805.rootfs.wic.bz2</a></p></li>
<li><p><a class="reference external" href="https://pionix-update.de/belaybox-basecamp-demo/stable/belaybox-image-raspberrypi4-20240912100805.rootfs.wic.bmap">https://pionix-update.de/belaybox-basecamp-demo/stable/belaybox-image-raspberrypi4-20240912100805.rootfs.wic.bmap</a></p></li>
</ol>
</div></blockquote>
<p>(2) Power up the BelayBox or - if the Yak is used alone - apply 12 V to the
“12 IN” pins.</p>
<p>The red power LED on the Yak should light up constantly now.</p>
<ol class="arabic simple" start="3">
<li><p>Connect the Yak board via Micro-USB to the host system.</p></li>
</ol>
<p>(4) Enable the CM4 storage mode so that the eMMC becomes available to the host
system:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>rpiboot
</pre></div>
</div>
<p>The green LED on the Yak board should light up constantly now.</p>
<ol class="arabic simple" start="5">
<li><p>To find the eMMC device, do:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>lsblk
</pre></div>
</div>
<p>Check the output and look for a approximately 16 GB device called /dev/sdX -
where X can be any letter.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure to select the correct device as data loss can occure if the wrong
device is selected!</p>
</div>
<p>(6) Make sure the .wic.bz2 file and the .bmap file are in the same directory
and flash the eMMC. In the command below, replace &lt;image file&gt;.bz2 with your
downloaded image file and replace “X” according to your eMMC device.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>bmaptool<span class="w"> </span>copy<span class="w"> </span>&lt;image<span class="w"> </span>file&gt;.bz2<span class="w"> </span>/dev/sdX
</pre></div>
</div>
<p>After roughly nine minutes the flashing should have finished.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Make sure to connect the WiFi antenna to the CM4 after flashing. The image
activates the external antenna support. Running a flashed Yak without the
WiFi antenna mounted can result in damage of the WiFi chip.</p>
</div>
<p>(7) Disconnect the eMMC device, power off and unplug the “boot” jumper from the
Yak board.</p>
<img alt="../_images/yak-assembly-9.jpg" src="../_images/yak-assembly-9.jpg" />
<p>With the raspberry CM4, it can be that the overlay filesystem sometimes does
not get mounted in the right order; so you might have to reboot twice if some
files are missing after flashing.</p>
</section>
<section id="assembling-the-yeti-board">
<h3><span class="section-number">11.2.3. </span>Assembling the Yeti Board<a class="headerlink" href="#assembling-the-yeti-board" title="Permalink to this heading">¶</a></h3>
<p>Here’s what you should have:</p>
<img alt="../_images/yeti-assembly-1-overview-w550.png" src="../_images/yeti-assembly-1-overview-w550.png" />
<p>Tools needed:</p>
<ul class="simple">
<li><p>ESD safe environment, e.g. ESD wrist band</p></li>
<li><p>ESD underlay mat</p></li>
</ul>
<p>Clip on the touch protection cage and make sure all clips are correctly seated
as shown here:</p>
<img alt="../_images/yeti-assembly-2-w500.png" src="../_images/yeti-assembly-2-w500.png" />
<p>Clip in the smaller part of the touch protection and make sure all clips are
correctly seated as shown here:</p>
<img alt="../_images/yeti-assembly-3-w500.png" src="../_images/yeti-assembly-3-w500.png" />
<p>Clip in the bigger part of the touch protection and make sure all clips are
correctly seated as shown in the following image:</p>
<img alt="../_images/yeti-assembly-4-w425.png" src="../_images/yeti-assembly-4-w425.png" />
<p>Your mission can be seen as accomplished if your Yeti looks like that:</p>
<img alt="../_images/yeti-assembly-5-w500.png" src="../_images/yeti-assembly-5-w500.png" />
</section>
<section id="preparing-the-cable-set">
<h3><span class="section-number">11.2.4. </span>Preparing the cable set<a class="headerlink" href="#preparing-the-cable-set" title="Permalink to this heading">¶</a></h3>
<p>That’s how we start:</p>
<img alt="../_images/cable-set-1-overview-w500.png" src="../_images/cable-set-1-overview-w500.png" />
<p>The <strong>10-position cable between Yeti and Yak</strong> is mandatory to connect Yak to
Yeti and to power the Yak board from the Yeti power supply.</p>
<img alt="../_images/cable-set-2-w400.png" src="../_images/cable-set-2-w400.png" />
<p>Plug in one of the crimped cables with one end into the 10-position plug. Make
sure to plug in the crimp in the exact same orientation as shown in the
picture above.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be aware that the crimps cannot be unplugged again from the 10 position
plug. Make sure you plug in the crimps in the correct positions before
actually plugging them in.</p>
</div>
<p>Plug in the other crimped end of the cable into the second plug. It is very
important to plug in the crimps in the shown “1:1” fashion. Doing otherwise
will permanently damage the Yak and/or Yeti board.</p>
<img alt="../_images/cable-set-3-w500.png" src="../_images/cable-set-3-w500.png" />
<p>Continue with plugging in all ten cables one after the other as there is less
chance of getting it wrong this way.</p>
<p>This is how the cable looks when assembly is done:</p>
<img alt="../_images/cable-set-4-w500.png" src="../_images/cable-set-4-w500.png" />
<p>Let’s continue with the <strong>6-position CAN + RS485 cable</strong>.</p>
<img alt="../_images/cable-set-5-w550.png" src="../_images/cable-set-5-w550.png" />
<p>Plug in a crimped cable with one end into the 6-position plug.
Make sure to plug in the crimp in the exact same orientation as shown in the
picture above. Continue with plugging in all needed cables.</p>
<p>Be aware that these cables have unisolated, open ends. In case you use the
6-position cable for e.g. using the CAN bus, make sure all other not used
cables are isolated to prevent damage to the Yak board.</p>
<p>This is how the assembled cable looks like:</p>
<img alt="../_images/cable-set-6-w500.png" src="../_images/cable-set-6-w500.png" />
<p>This is the pin description of the Yak board’s 4-, 6- and 10-position sockets:</p>
<img alt="../_images/cable-set-7-w550.png" src="../_images/cable-set-7-w550.png" />
</section>
<section id="final-yak-yeti-cable-setup">
<h3><span class="section-number">11.2.5. </span>Final Yak-Yeti-Cable-Setup<a class="headerlink" href="#final-yak-yeti-cable-setup" title="Permalink to this heading">¶</a></h3>
<p>Tools needed:</p>
<ul class="simple">
<li><p>ESD safe environment, e.g. ESD wrist band</p></li>
<li><p>ESD underlay mat</p></li>
<li><p>Preassembled Yak, Yeti kits and cable-set as shown in sections above</p></li>
</ul>
<img alt="../_images/final-assembly-w425.png" src="../_images/final-assembly-w425.png" />
<p>Plug in the 10-pin cable into the corresponding sockets on both ends.
Plug in the 4-pin RFID/NFC reader cable.
The assembly of Yak, Yet kit and cable set is completed.</p>
<p>When using the assembly in a “desk” environment, it is recommended to apply
power through the 12 V DC barrel connector shown in the upper right corner of
the Yeti board in the image above. Make sure the WiFi antenna does not touch
any other open PCB parts to prevent damage to the boards.</p>
</section>
</section>
<section id="belaybox-use-cases">
<span id="belaybox-furtherinfo"></span><h2><span class="section-number">11.3. </span>BelayBox Use Cases<a class="headerlink" href="#belaybox-use-cases" title="Permalink to this heading">¶</a></h2>
<section id="how-to-install-updates-via-rauc-bundles">
<span id="belaybox-rauc"></span><h3><span class="section-number">11.3.1. </span>How to install updates via RAUC bundles<a class="headerlink" href="#how-to-install-updates-via-rauc-bundles" title="Permalink to this heading">¶</a></h3>
<p>Connect via SSH into your Yak board. The credentials are:</p>
<ul class="simple">
<li><p>User: root</p></li>
<li><p>Password: basecamp</p></li>
</ul>
<p>Check the currently booted slot:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rauc<span class="w"> </span>status
</pre></div>
</div>
<p>Remember the slot for comparison afterwards.</p>
<p>Execute the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rauc<span class="w"> </span>install<span class="w"> </span>https://pionix-update.de/belaybox-basecamp-demo/stable/belaybox-bundle-raspberrypi4-20240912103122.raucb
</pre></div>
</div>
</section>
<section id="cross-compile-toolchain">
<span id="belaybox-yeti-flash"></span><h3><span class="section-number">11.3.2. </span>Cross-compile toolchain<a class="headerlink" href="#cross-compile-toolchain" title="Permalink to this heading">¶</a></h3>
<p>If you want to cross-compile your EVerest version, this is the toolchain to
use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>https://pionix-update.de/belaybox-basecamp-demo/stable/poky-glibc-x86_64-belaybox-image-cortexa7t2hf-neon-vfpv4-raspberrypi4-toolchain-4.0.16.sh
</pre></div>
</div>
<p>First of all you need to install it. It is a shell script, so just do a
“chmod +x name_of_toolchain.sh” and then run it with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./name_of_toolchain.sh
</pre></div>
</div>
<p>You will be asked where to install it. You can e.g. install it in your home
directory - somewhere like /home/myuser/toolchain-belaybox</p>
<p>Then you need to source the environment variables (it tells you how to do it
at the end of the installation).</p>
<p>Once they are sourced, this terminal will cross compile.</p>
<p>In everest-core, create a folder called “build-cross”. Change into it.</p>
<p>There, run cmake as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake<span class="w"> </span>..<span class="w"> </span>-GNinja<span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>/var/everest<span class="w"> </span>-DEVEREST_ENABLE_PY_SUPPORT<span class="o">=</span>OFF<span class="w"> </span>-DEVEREST_ENABLE_JS_SUPPORT<span class="o">=</span>OFF<span class="w"> </span>-Deverest-core_USE_PYTHON_VENV<span class="o">=</span>OFF
</pre></div>
</div>
<p>In this case, the PY/JS support flags are set to OFF. You may need to set them
to ON if you are using simulation. The last option
<code class="docutils literal notranslate"><span class="pre">-Deverest-core_USE_PYTHON_VENV</span></code> is only a temporarily needed directive that
will probably be obsolete in future release candidates.
The <code class="docutils literal notranslate"><span class="pre">-GNinja</span></code> can also be left out, then it will use make.</p>
<p>After that you can build with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>-j10
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ninja
</pre></div>
</div>
<p>depending on what you configured.</p>
<p>Once the build is complete, you can rsync directly to belaybox like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">DESTDIR</span><span class="o">=</span>dist<span class="w"> </span>ninja<span class="w"> </span>install/strip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rsync<span class="w"> </span>-av<span class="w"> </span>dist/var/everest<span class="w"> </span>root@the.ip.add.ress:/var
</pre></div>
</div>
<p>Replace the IP address placeholder with the correct one.</p>
<p>Then log into the BelayBox and stop the systemd service:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>stop<span class="w"> </span>basecamp
</pre></div>
</div>
<p>Then you can run your self-compiled version like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/var/everest/bin/manager<span class="w"> </span>--conf<span class="w"> </span>/path/to/my/configfile
</pre></div>
</div>
</section>
<section id="how-to-flash-the-yeti-board">
<h3><span class="section-number">11.3.3. </span>How to flash the Yeti board<a class="headerlink" href="#how-to-flash-the-yeti-board" title="Permalink to this heading">¶</a></h3>
<p>Connect via SSH into the Yak board and run these two commands (the first one
is very important - do not update while EVerest/BaseCamp is running!):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>stop<span class="w"> </span>basecamp
yeti_fwupdate<span class="w"> </span>/dev/serial0<span class="w"> </span>/usr/share/everest/modules/YetiDriver/firmware/yetiR1_2.1_firmware.bin
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In case you use a fullsize Raspberry Pi 4B, use the following command
instead of the above one:</p>
<p>systemctl stop basecamp-rpi</p>
</div>
<p>After that, restart the basecamp or basecamp-rpi service:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>restart<span class="w"> </span>basecamp
</pre></div>
</div>
<p>or (respectively)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>restart<span class="w"> </span>basecamp-rpi
</pre></div>
</div>
</section>
<section id="how-to-activate-ocpp-2-0-1">
<h3><span class="section-number">11.3.4. </span>How to activate OCPP 2.0.1<a class="headerlink" href="#how-to-activate-ocpp-2-0-1" title="Permalink to this heading">¶</a></h3>
<p>This how-to is based on the software status from 2024-08-27.</p>
<p>As development is currently ongoing, there will be changes. So, it is a good
idea to revisit this page in future.</p>
<section id="some-information-before-setting-up-ocpp-2-0-1">
<h4><span class="section-number">11.3.4.1. </span>Some information before setting up OCPP 2.0.1<a class="headerlink" href="#some-information-before-setting-up-ocpp-2-0-1" title="Permalink to this heading">¶</a></h4>
<p>Consider doing a RAUC update to get the most up-to-date software version
running - see <a class="reference internal" href="#belaybox-rauc"><span class="std std-ref">section about RAUC updates</span></a>.</p>
<p>If you want to test OCPP with a local backend,</p>
<ol class="arabic simple">
<li><p>please build EVerest on your local machine first in order to create the</p></li>
</ol>
<blockquote>
<div><p>necessary certificates and</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>install <a class="reference external" href="https://github.com/EVerest/ocpp-csms">https://github.com/EVerest/ocpp-csms</a> on your local machine.</p></li>
</ol>
</section>
<section id="configuration-on-the-belaybox">
<h4><span class="section-number">11.3.4.2. </span>Configuration on the BelayBox<a class="headerlink" href="#configuration-on-the-belaybox" title="Permalink to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>Connect via SSH to the BelayBox (credentials are “root/basecamp”).</p></li>
<li><p>Open the file /etc/everest/ocpp201-pnc-config.json in a text or code editor</p></li>
</ol>
<blockquote>
<div><p>and check the CentralSystemURI. Set your own local IP address of the machine
which is running ocpp-csms. Default port is 9000 and charger ID is
MYCHARGER001. SecurityProfile should be set to value 1.</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>There are some further example configuration files, which you can have a</p></li>
</ol>
<blockquote>
<div><p>look at to learn about further setting options and see how things are
connected. Those files are the yaml files in directory /etc/everest/.</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Also have a look at /config/v201/profile_schemas. All parameters which are</p></li>
</ol>
<blockquote>
<div><p>not listed as required, can be set optionally.</p>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>See the component configuration files at</p></li>
</ol>
<blockquote>
<div><p>/usr/share/everest/modules/OCPP201/component_config
Edit those files for setting your specific charge point scenario.</p>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>The directory /user-config/v201/component_schemas/custom/ contains the</p></li>
</ol>
<blockquote>
<div><p>EVSE and connector definitions. Remove the ones that are not required ones
for your dedicated scenario.</p>
</div></blockquote>
</section>
<section id="running-the-scripts-and-manager-processes">
<h4><span class="section-number">11.3.4.3. </span>Running the scripts and manager processes<a class="headerlink" href="#running-the-scripts-and-manager-processes" title="Permalink to this heading">¶</a></h4>
<p>Have a look at /usr/bin/ocpp201_init.sh to see if all paramaters are set as
required for your dedicated scenario and run the shell script.</p>
<p>After that, restart the BaseCamp process (make sure to use the correct config
file as parameter):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>stop<span class="w"> </span>basecamp
manager<span class="w"> </span>–config<span class="w"> </span>config-belaybox-pwm-ocpp.yaml
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Running the manager process for the first time, you can get a warning that
no key pair could be found for v2g ocsp request. As after the first startup,
a key pair is generated, this message should not be shown next time.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The process of updating the values of the database via the script will be
obsolete in the next major release of the Yak image. Until then, every
update will reset the config entries in /usr/share/everest/modules/.
So please create a backup of your config entries before any RAUC update.</p>
</div>
</section>
<section id="additional-information">
<h4><span class="section-number">11.3.4.4. </span>Additional information<a class="headerlink" href="#additional-information" title="Permalink to this heading">¶</a></h4>
<p>If you want to take a look at the database migration scripts, see here:
/usr/share/everest/modules/OCPP201/core_migrations/</p>
<p>Those are the changes in the database that are performed when upgrading or
downgrading to another database version.</p>
</section>
</section>
<section id="factory-reset">
<h3><span class="section-number">11.3.5. </span>Factory reset<a class="headerlink" href="#factory-reset" title="Permalink to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We are preparing a new factory reset howto for the updated Yocto-image.</p>
</div>
</section>
<section id="further-information">
<h3><span class="section-number">11.3.6. </span>Further information<a class="headerlink" href="#further-information" title="Permalink to this heading">¶</a></h3>
<section id="rs-485-modbus-config-for-yak-board">
<h4><span class="section-number">11.3.6.1. </span>RS-485 Modbus config for Yak board<a class="headerlink" href="#rs-485-modbus-config-for-yak-board" title="Permalink to this heading">¶</a></h4>
<p>If you want to use the RS-485 Modbus device on the Yak board and the current
(July 2024 or later) basecamp image, here is how you configure it in the
config.yaml for the SerialCommunicationHub:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>comm_hub:
<span class="w">  </span>config_implementation:
<span class="w">    </span>main:
<span class="w">  </span>serial_port:<span class="w"> </span>/dev/ttyAMA3
<span class="w">      </span>baudrate:<span class="w"> </span><span class="m">19200</span>
<span class="w">      </span>parity:<span class="w"> </span><span class="m">2</span>
<span class="w">      </span>rxtx_gpio_chip:<span class="w"> </span>gpiochip0
<span class="w">      </span>rxtx_gpio_line:<span class="w"> </span><span class="m">16</span>
<span class="w">      </span>rxtx_gpio_tx_high:<span class="w"> </span><span class="nb">true</span>
<span class="w">  </span>module:<span class="w"> </span>SerialCommHub
</pre></div>
</div>
</section>
</section>
</section>
<section id="troubleshooting">
<h2><span class="section-number">11.4. </span>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading">¶</a></h2>
<section id="yeti-errors-or-everest-not-starting">
<h3><span class="section-number">11.4.1. </span>Yeti errors or EVerest not starting<a class="headerlink" href="#yeti-errors-or-everest-not-starting" title="Permalink to this heading">¶</a></h3>
<p>Should your log output tell you something about “Yeti reset not successful”
or the EVerest modules get terminated right after EVerest started, it could
be due to the Yeti interface not being connected properly.</p>
<p>In this case, check the connections and the cable harness.</p>
<p>Should everything look fine, check if the Yeti firmware is running properly
by looking at the Yeti LED. If you are running firmware version 1, it should
flash one time. If you are running version 2, it should flash two times.</p>
<p>If it is on or off without flashing, the firmware could not be started or is
not installed.</p>
</section>
<section id="no-reboot-after-rauc-update">
<h3><span class="section-number">11.4.2. </span>No reboot after RAUC update<a class="headerlink" href="#no-reboot-after-rauc-update" title="Permalink to this heading">¶</a></h3>
<p>If you have done a RAUC udpate and the Linux system does not reboot after some
seconds, execute:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tryboot
</pre></div>
</div>
<p>After the next boot, connect via SSH again and check the currently booted slot
again. It should have switched to the other slot.</p>
<p>If it did not switch to the other slot and the slot is marked as “bad”, you
could try to re-flash the Yeti board with an up-to-date firmware version.</p>
<p>If this does not help, please find support in
<a class="reference external" href="https://everest.github.io/nightly/#everest-compass">the mailing list or Zulip channels</a>
.</p>
</section>
<section id="short-cheat-sheet">
<h3><span class="section-number">11.4.3. </span>Short cheat sheet<a class="headerlink" href="#short-cheat-sheet" title="Permalink to this heading">¶</a></h3>
<p>The new ssh login credentials for the Yocto image are:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>user:<span class="w"> </span>root
pw:<span class="w"> </span>basecamp
</pre></div>
</div>
<p>The default config file being used by the basecamp.service is the symlink
in</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/etc/everest/basecamp.yaml
</pre></div>
</div>
<p>It points to the config to be used. This can be
changed to a config to your liking:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>/etc/everest/basecamp.yaml
ln<span class="w"> </span>-s<span class="w"> </span>/etc/everest/&lt;your-custom-config&gt;<span class="w"> </span>/etc/everest/basecamp.yaml
</pre></div>
</div>
<p>After this, restart the basecamp service or reboot.</p>
<p>Should you see any “Unknown config entry” errors when starting the manager
process, delete the corresponding config entries from the yaml file you are
using for startup.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../general/01_framework/index.html">1. EVerest Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/02_detail_pre_setup.html">2. Prepare Your Development Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/03_quick_start_guide.html">3. A Kind Of Quick Guide To EVerest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/04_detail_module_concept.html">4. EVerest Modules in Detail</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/05_existing_modules.html">5. EVerest Module Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/06_handling_bank_cards.html">6. Bank Card Payment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/07_configure_plug_and_charge.html">7. Configure Plug&amp;Charge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_tools/index.html">8. EVerest development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">9. Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/faq.html">10. Frequently Asked Questions And Best Practices</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">11. Pionix BelayBox</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">11.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-hardware-and-software">11.2. Setting up Hardware and Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="#belaybox-use-cases">11.3. BelayBox Use Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">11.4. Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/02_snapshot.html">12. Snapshot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/01_everest_reference/index.html">13. EVerest Reference</a></li>
</ul>

  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../general/faq.html"
                          title="previous chapter"><span class="section-number">10. </span>Frequently Asked Questions And Best Practices</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../appendix/02_snapshot.html"
                          title="next chapter"><span class="section-number">12. </span>Snapshot</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/hardware/pionix_belay_box.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div><h3>Community</h3>
<ul class="nav nav-sidebar">
<li><a href="https://lists.lfenergy.org/g/everest" target="_blank"><img src="../_static/icons/mail.svg" style="height: 0.8em" /> Get Support</a></li>
<li><a href="https://www.youtube.com/@lfe_everest" target="_blank"><img src="../_static/icons/youtube.svg" style="height: 0.8em" /> YouTube Channel</a></li>
<li><a href="https://twitter.com/everestincharge" target="_blank"><img src="../_static/icons/twitter.svg" style="height: 0.8em" /> Twitter</a></li>
<li><a href="https://fosstodon.org/@EVerest" target="_blank">Mastodon</a></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../appendix/02_snapshot.html" title="12. Snapshot"
             >next</a> |</li>
        <li class="right" >
          <a href="../general/faq.html" title="10. Frequently Asked Questions And Best Practices"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">EVerest  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">11. </span>Pionix BelayBox</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Pionix GmbH.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>