
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Workspace Architecture &#8212; EVerest  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css" />
    <link rel="stylesheet" type="text/css" href="_static/contentui.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/contentui.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">EVerest  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Workspace Architecture</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="workspace-architecture">
<h1>Workspace Architecture<a class="headerlink" href="#workspace-architecture" title="Permalink to this headline">¶</a></h1>
<p><em>Current status of Q1 2021</em></p>
<section id="general">
<h2>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h2>
<p>For a safer development the project is capsuled in docker container.More specific, there is one docker container for the publish- and subscriber handler MQTT,
that enables an asynchronous communication through topics generated by the broker (topic-handler).The second docker-container includes the OCPP communication as
a standard interface between the electric vehicle supply equipment (EVSE) and the software-grid of the infrastructure-management, called CSMS-Cloud.
In summary the MQTT-Docker takes over the functions in the inner ecosystem of the supply equipment and the OCPP-Docker allows function between the outside world.</p>
<p>The workspace is structured in directories with the main elements of the framework, utlity-directories and the location of all modules.</p>
<a class="reference internal image-reference" href="_images/everest_workspace.png"><img alt="_images/everest_workspace.png" class="align-right" src="_images/everest_workspace.png" style="width: 150%;" /></a>
</section>
<section id="devlopment-in-the-workspace">
<h2>Devlopment in the Workspace<a class="headerlink" href="#devlopment-in-the-workspace" title="Permalink to this headline">¶</a></h2>
<p>The basic structure inside the framework is defined by the JavaScript Object Notation (JSON) as a communication interface for configurations, variables and commands
between the modules of the EVerest enviroment. The main part to define the communication transport ways and the requirements of the modules among themselves are
declared in the config.json.Each module as a package in the ‘src / module’ directory requires a minimal content of scripts in order to be properly managed by the
framework. A Module defines an application of the charging station architecture and  contains one or more units.The minimum of a module includes -the ‘manifest.json’
for the decalartion of the module for the specific module, -the unit-script itself like the ‘LogicalCore.py’ - the __init_.py that imports the unit-script.</p>
<img alt="_images/development_enviroment.png" src="_images/development_enviroment.png" />
</section>
<section id="conifg-json">
<h2>conifg.json<a class="headerlink" href="#conifg-json" title="Permalink to this headline">¶</a></h2>
<p>This script contains the declaration of all modules and their configurations for the integration inside the whole enviroment. On the first indentation-level
there are all the modules introduced as module_id’s with each of its individual specific contents.
The example shows a declaration of three modules with each an main unit and how a module can be connected with other units.</p>
<p>The ‘Key Value Store’-module shows the minimum requirement for a declaration which contents the first indentation with the module_id ‘kvs’ and contains in the
second indentation the modulename which has to match with the directory-name.</p>
<p>Shown in example of the hardware module the connection from itself to the ‘main’-unit of the ‘kvs’-module and to ‘main’-unit of the ‘ocpp’-module.
Inside the manifest.json of the hardware-module the requirements of the necessary classes are introduced with its own namespacing,
like ‘req1’ or ‘kvs’. In the config.json these requirements have to be contained inside a a “connections”-element of the module.
Where the manifest explains which classes are necessary, the config indicates which unit from the environment can provide the required class.
For this, the specific requirement includes the specific module_id, like “ocpp” or “kvs” declared in the first indentation of the config.json and the unit_id,
which is declared in the manifest.json of the required units module-directory.
Each connection can be declared as optional, which still allows running the manager, which starts all existing modules,
even if the optional unit is not introduced or implemented.</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;kvs&quot;</span><span class="o">:</span> <span class="p">{</span>                                        <span class="c1">//first module_id: kvs</span>
        <span class="s2">&quot;module&quot;</span><span class="o">:</span> <span class="s2">&quot;KeyValueStore&quot;</span>                   <span class="c1">//module_name matching the directory name in the modules dir)</span>
    <span class="p">},</span>
    <span class="s2">&quot;hardware&quot;</span><span class="o">:</span> <span class="p">{</span>                                   <span class="c1">//second module id: hardware</span>
        <span class="s2">&quot;module&quot;</span><span class="o">:</span> <span class="s2">&quot;HardwareDriver&quot;</span><span class="p">,</span>                 <span class="c1">//module name (matching the directory name in the modules dir)</span>
        <span class="s2">&quot;connections&quot;</span><span class="o">:</span> <span class="p">{</span>                            <span class="c1">//first connection for package hardware to unit main of ocpp</span>
            <span class="s2">&quot;optional:req1&quot;</span><span class="o">:</span> <span class="p">{</span>                      <span class="c1">//connectionname which is defined in the manifest.json of the hardware-module and declared as optional</span>
                <span class="s2">&quot;module_id&quot;</span><span class="o">:</span> <span class="s2">&quot;ocpp&quot;</span><span class="p">,</span>                <span class="c1">//declare module-connection with module_id and unit_id</span>
                <span class="s2">&quot;unit_id&quot;</span><span class="o">:</span> <span class="s2">&quot;main&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;optional:kvs&quot;</span><span class="o">:</span> <span class="p">{</span>                       <span class="c1">//second connection for package hardware to unit main of kvs</span>
                <span class="s2">&quot;module_id&quot;</span><span class="o">:</span> <span class="s2">&quot;kvs&quot;</span><span class="p">,</span>
                <span class="s2">&quot;unit_id&quot;</span><span class="o">:</span> <span class="s2">&quot;main&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;ocpp&quot;</span><span class="o">:</span> <span class="p">{</span>                                       <span class="c1">//third module_id: ocpp</span>
        <span class="s2">&quot;module&quot;</span><span class="o">:</span> <span class="s2">&quot;OCPP&quot;</span><span class="p">,</span>                           <span class="c1">//module_name: OCPP (matching the directory name in the modules dir)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="logger-json">
<h2>logger.json<a class="headerlink" href="#logger-json" title="Permalink to this headline">¶</a></h2>
<p>Defines the basic configurations of the logging format, like the font and color style of the differend categories of informations
The logger.json allows task focused logging as handlers for example standard-datastreaming or files. Each handler includes properties, like their class, formatter and priority-level.General logging is defined for each module categorized in the “DEBUG”-level</p>
</section>
<section id="main-py">
<h2>main.py<a class="headerlink" href="#main-py" title="Permalink to this headline">¶</a></h2>
<p>The main.py is needed to start single modules by the commandline and manages at the beginning, execution and exiting of the running process.</p>
<p>Starting a module is possible by execution of this specific commandline:
<strong>./main.py -m module_id</strong></p>
<p><em>It is visible that the shortcut -m points on the module_id, which was decalered in the config.json</em></p>
<p><strong>Inside the code</strong>
The format of the inputs in the commandline which are relevant to start modules or are needed for an interaction withhin runtime are realised through the Argument-Parser.
Typically each argument represented as string-word or a string-shortcut describe an option in the command.
These options can activate a procedure and can also hand over values for the inital configurations.
The main application core starts by calling the Everest class with the initialazing the modules and their configurations,
which are specified by the arguments from the command line. Initializing means importing the classes and their attributes.
By failing to import the elements, the system will cleanup, give a short feedback through the logger which part of the import failed and exits with an error.
By success a logger is giving a string-information and is followed by starting the mqtt client connection to launch the mqtt-client with its continuous loop.
If the mqqt-client is disconnected the system will automatically shutdown.
Early as possible for a detailed error detection. the logger-subroutines and follows directly with trying to load the configurations.
If the routine failed to load the configurations it directly exits the system or when an internal error arises.Also if the configuration is corrupted,
at example by missing essential properties like the module_id the system will exits with an error to prevent loading an flawed module.
With an successfully loaded configuration of the modules, follows an extraction of property values for the further process.
By exit functioncaller insures to disconnect the client/s. and during the cleanup triggered by an keyboardexception the system exits with an error.</p>
</section>
<section id="manager-py">
<h2>manager.py<a class="headerlink" href="#manager-py" title="Permalink to this headline">¶</a></h2>
<p>The manager is similar to to the main.py with main differences for that it starts all introduced modules and checks if all connected signals are provided
for a dependent module. This secures that the operational sequence of a higher module is not broken through an interaction before all requirements are not avaiable.</p>
<p><strong>NEEDS MORE INFORAMTIONS</strong></p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Workspace Architecture</a><ul>
<li><a class="reference internal" href="#general">General</a></li>
<li><a class="reference internal" href="#devlopment-in-the-workspace">Devlopment in the Workspace</a></li>
<li><a class="reference internal" href="#conifg-json">conifg.json</a></li>
<li><a class="reference internal" href="#logger-json">logger.json</a></li>
<li><a class="reference internal" href="#main-py">main.py</a></li>
<li><a class="reference internal" href="#manager-py">manager.py</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/doc_workspace.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">EVerest  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Workspace Architecture</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Pionix GmbH.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.1.
    </div>
  </body>
</html>