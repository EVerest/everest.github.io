<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ocpp: Smart Charging Use Cases</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ocpp<span id="projectnumber">&#160;0.24.1</span>
   </div>
   <div id="projectbrief">A C++ implementation of the Open Charge Point Protocol</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Smart Charging Use Cases </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The use cases within the Smart Charging functional block are subdivided into the following three categories of use cases:</p>
<ol type="1">
<li>General Smart Charging (Use Cases K01–K10)</li>
<li>External Charging Limit-based Smart Charging (K11–K14)</li>
<li>ISO 15118-based Smart Charging (K15–K17)</li>
</ol>
<p >Support for General and External Charging Limit-based Smart Charging is largely complete, with ISO 15118-based Smart Charging under active development. For an up-to-date overview of exactly which features are currently supported as well as design decisions that have been made to address optional or ambiguous functional requirements, please refer to the <a class="el" href="md_doc_v2_ocpp_2x_status.html">OCPP 2.0.1 Status document</a>.</p>
<h1><a class="anchor" id="autotoc_md79"></a>
K01 SetChargingProfile</h1>
<p >Allows the CSMS to influence the charging power or current drawn from a specific EVSE or the entire Charging Station over a period of time.</p>
<div class="fragment"><div class="line">sequenceDiagram</div>
<div class="line">    CSMS-&gt;&gt;+ChargePoint : SetChargingProfileRequest(call)</div>
<div class="line"> </div>
<div class="line">    ChargePoint-&gt;&gt;+DeviceModel : SmartChargingCtrlrAvailable?</div>
<div class="line">    DeviceModel--&gt;&gt;-ChargePoint : Component</div>
<div class="line"> </div>
<div class="line">    rect rgb(128,202,255) </div>
<div class="line">    break SmartChargingCtrlrAvailable = false</div>
<div class="line">        ChargePoint--&gt;&gt;CSMS : Smart Charging NotSupported CallError</div>
<div class="line">    end</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    ChargePoint-&gt;&gt;+SmartCharging : validate_and_add_profile(call.msg.Profile, call.msg.EVSE ID)</div>
<div class="line"> </div>
<div class="line">    SmartCharging-&gt;&gt;SmartCharging : validate_profile(Profile, EVSE ID)</div>
<div class="line"> </div>
<div class="line">    rect rgb(128,202,255) </div>
<div class="line">    break Invalid Profile</div>
<div class="line">        SmartCharging--&gt;&gt;ChargePoint : SetChargingProfileResponse: Rejected</div>
<div class="line">        ChargePoint--&gt;&gt;CSMS : SetChargingProfileResponse: Rejected</div>
<div class="line">    end</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    SmartCharging-&gt;&gt;+SmartCharging : add_profile(Profile, EVSE ID)</div>
<div class="line">    SmartCharging-&gt;&gt;-EVerest : signal_set_charging_profiles_callback</div>
<div class="line"> </div>
<div class="line">    SmartCharging--&gt;&gt;-ChargePoint : SetChargingProfileResponse: Accepted</div>
<div class="line"> </div>
<div class="line">    ChargePoint--&gt;&gt;-CSMS : SetChargingProfileResponse: Accepted</div>
</div><!-- fragment --><p >Profile validation returns the following errors to the caller when a Profile is <code>Rejected</code>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Errors   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>ChargingProfileFirstStartScheduleIsNotZero</code>   </td><td class="markdownTableBodyLeft">The <code>startPeriod</code> of the first <code>chargingSchedulePeriod</code> needs to be 0.<br  />
[K01.FR.31]    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>ChargingProfileNoChargingSchedulePeriods</code>   </td><td class="markdownTableBodyLeft">Happens when the <code>ChargingProfile</code> doesn't have any Charging Schedule Periods.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>ChargingScheduleChargingRateUnitUnsupported</code>   </td><td class="markdownTableBodyLeft">Happens when a chargingRateUnit is passed in that is not configured in the <code>ChargingScheduleChargingRateUnit</code>. [K01.FR.26]    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>ChargingSchedulePeriodInvalidPhaseToUse</code>   </td><td class="markdownTableBodyLeft">Happens when an invalid <code>phaseToUse</code> is passed in. [K01.FR.19] [K01.FR.48]    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>ChargingSchedulePeriodPhaseToUseACPhaseSwitchingUnsupported</code>   </td><td class="markdownTableBodyLeft">Happens when <code>phaseToUse</code> is passed in and the EVSE does not have <code>ACPhaseSwitchingSupported</code> defined and set to true. [K01.FR.20] [K01.FR.48]    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>ChargingSchedulePeriodsOutOfOrder</code>   </td><td class="markdownTableBodyLeft"><code>ChargingSchedulePeriod.startPeriod</code> elements need to be in increasing values. [K01.FR.35]    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>ChargingStationMaxProfileCannotBeRelative</code>   </td><td class="markdownTableBodyLeft">Happens when a <code>ChargingStationMaxProfile.chargingProfileKind</code> is set to <code>Relative</code>. [K01.FR.38]    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>ChargingStationMaxProfileEvseIdGreaterThanZero</code>   </td><td class="markdownTableBodyLeft">Happens when a <code>ChargingStationMaxProfile</code> is attempted to be set with an EvseID isn't <code>0</code>. [K01.FR.03]    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>ChargingProfileMissingRequiredStartSchedule</code>   </td><td class="markdownTableBodyLeft">Happens when an <code>Absolute</code> or <code>Recurring</code> <code>ChargingProfile</code> doesn't have a <code>startSchedule</code>. [K01.FR.40]    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>ChargingProfileExtraneousStartSchedule</code>   </td><td class="markdownTableBodyLeft">Happens when a Relative <code>ChargingProfile</code> has a <code>startSchedule</code>. [K01.FR.41]    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>EvseDoesNotExist</code>   </td><td class="markdownTableBodyLeft">Happens when the <code>evseId</code>of a <code>SetChargingProfileRequest</code> does not exist. [K01.FR.28]    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>ExistingChargingStationExternalConstraints</code>   </td><td class="markdownTableBodyLeft">Happens when a <code>SetChargingProfileRequest</code> Profile has a purpose of <code>ChargingStationExternalConstraints</code> and one already exists with the same <code>ChargingProfile.id</code> exists. [K01.FR.05]    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>InvalidProfileType</code>   </td><td class="markdownTableBodyLeft">Happens when a <code>ChargingStationMaxProfile</code> is attempted to be set with a <code>ChargingProfile</code> that isn't a <code>ChargingStationMaxProfile</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>TxProfileEvseHasNoActiveTransaction</code>   </td><td class="markdownTableBodyLeft">Happens when a <code>SetChargingProfileRequest</code> with a <code>TxProfile</code> is submitted and there is no transaction active on the specified EVSE. [K01.FR.09]    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>TxProfileEvseIdNotGreaterThanZero</code>   </td><td class="markdownTableBodyLeft"><code>TxProfile</code> needs to have an <code>evseId</code> greater than 0. [K01.FR.16]    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>TxProfileMissingTransactionId</code>   </td><td class="markdownTableBodyLeft">A <code>transactionId</code> is required for<code>SetChargingProfileRequest</code>s with a <code>TxProfile</code> in order to match the profile to a specific transation. [K01.FR.03]    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code>TxProfileTransactionNotOnEvse</code>   </td><td class="markdownTableBodyLeft">Happens when the provided <code>transactionId</code> is not known. [K01.FR.33]    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code>TxProfileConflictingStackLevel</code>   </td><td class="markdownTableBodyLeft">Happens when a <code>TxProfile</code> has a <code>stackLevel</code> and <code>transactionId</code> combination already exists in a <code>TxProfile</code> with a different id in order to ensure that no two charging profiles with same stack level and purpose can be valid at the same time. [K01.FR.39]   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md80"></a>
K08 Get Composite Schedule</h1>
<p >The CSMS requests the Charging Station to report the Composite Charging Schedule, as calculated by the Charging Station for a specific point of time, and may change over time due to external causes such as local balancing based on grid connection capacity and EVSE availablity.</p>
<p >The Composite Schedule is the result of result of merging the time periods set in the <code>ChargingStationMaxProfile</code>, <code>ChargingStationExternalConstraints</code>, <code>TxDefaultProfile</code> and <code>TxProfile</code> type profiles.</p>
<div class="fragment"><div class="line">sequenceDiagram</div>
<div class="line"> </div>
<div class="line">    CSMS-&gt;&gt;+ChargePoint: GetCompositeSchedule(call)</div>
<div class="line"> </div>
<div class="line">    ChargePoint-&gt;&gt;+DeviceModel : ChargingScheduleChargingRateUnit?</div>
<div class="line">    DeviceModel--&gt;&gt;-ChargePoint : Component</div>
<div class="line"> </div>
<div class="line">    rect rgb(128,202,255) </div>
<div class="line">        break call.msg.chargingRateUnit is not supported</div>
<div class="line">            ChargePoint--&gt;&gt;CSMS : ChargingScheduleChargingRateUnitUnsupported CallError</div>
<div class="line">        end</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    ChargePoint-&gt;&gt;+EvseManager : does_evse_exist(call.msg.evseId)</div>
<div class="line">    EvseManager--&gt;&gt;-ChargePoint : bool</div>
<div class="line">    rect rgb(128,202,255) </div>
<div class="line">        break EVSE does not exist</div>
<div class="line">            ChargePoint--&gt;&gt;CSMS : EvseDoesNotExist CallError</div>
<div class="line">        end</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    ChargePoint-&gt;&gt;+SmartChargingHandler : get_valid_profiles(call.msg.evseId)</div>
<div class="line"> </div>
<div class="line">    SmartChargingHandler--&gt;&gt;-ChargePoint : vector&lt;ChargingProfile&gt;</div>
<div class="line"> </div>
<div class="line">    ChargePoint-&gt;&gt;+SmartChargingHandler : calculate_composite_schedule&lt;br/&gt;(vector&lt;ChargingProfile, now, msg.duration, evseId, call.msg.chargingRateUnit)</div>
<div class="line"> </div>
<div class="line">    loop ExternalConstraints, Max, TxDefault, and Tx Profiles</div>
<div class="line">        SmartChargingHandler-&gt;&gt;+Profile: calculate_composite_schedule(profiles)</div>
<div class="line">        Profile--&gt;&gt;-SmartChargingHandler: composite_schedule </div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    note right of SmartChargingHandler: Create consolidated CompositeSchedule&lt;br /&gt;from all 4 Profile types</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    SmartChargingHandler-&gt;&gt;+Profile: calculate_composite_schedule(ExternalConstraints, Max, TxDefault, Tx)</div>
<div class="line">    Profile--&gt;&gt;-SmartChargingHandler: CompositeSchedule</div>
<div class="line"> </div>
<div class="line">    SmartChargingHandler--&gt;&gt;-ChargePoint: CompositeSchedule</div>
<div class="line"> </div>
<div class="line">    ChargePoint--&gt;&gt;-CSMS : GetCompositeScheduleResponse(CompositeSchedule)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md81"></a>
K09 Get Charging Profiles</h1>
<p >Returns to the CSMS the Charging Schedules/limits installed on a Charging Station based on the passed in criteria.</p>
<div class="fragment"><div class="line">sequenceDiagram</div>
<div class="line"> </div>
<div class="line">    CSMS-&gt;&gt;+ChargePoint: GetChargingProfiles(criteria)</div>
<div class="line"> </div>
<div class="line">    ChargePoint-&gt;&gt;+SmartChargingHandler : get_reported_profiles(criteria)</div>
<div class="line"> </div>
<div class="line">    loop filter ChargingProfiles</div>
<div class="line">        SmartChargingHandler-&gt;&gt;SmartChargingHandler: filter on ChargingProfile criteria </div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    SmartChargingHandler--&gt;&gt;-ChargePoint : Vector&lt;Profiles&gt;</div>
<div class="line"> </div>
<div class="line">    ChargePoint--&gt;&gt;CSMS : GetChargingProfilesResponse(profiles)</div>
<div class="line"> </div>
<div class="line">    alt no Profiles</div>
<div class="line">    rect rgb(128,202,255)</div>
<div class="line">        ChargePoint--&gt;&gt;CSMS : GetChargingProfilesResponse(NoProfiles) </div>
<div class="line">        ChargePoint-&gt;&gt;CSMS : return</div>
<div class="line">    end</div>
<div class="line">        </div>
<div class="line">    else Profiles</div>
<div class="line">        ChargePoint--&gt;&gt;CSMS : GetChargingProfilesResponse(Accepted)</div>
<div class="line">    end</div>
<div class="line"> </div>
<div class="line">    ChargePoint-&gt;&gt;ChargePoint : determine profiles_to_report</div>
<div class="line"> </div>
<div class="line">    ChargePoint--&gt;&gt;-CSMS : ReportChargingProfilesRequest(profiles_to_report)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md82"></a>
K10 Clear Charging Profile</h1>
<p >Clears Charging Profiles installed on a Charging Station based on the passed in criteria.</p>
<div class="fragment"><div class="line">sequenceDiagram</div>
<div class="line"> </div>
<div class="line">    CSMS-&gt;&gt;+ChargePoint: ClearChargingProfileRequest(criteria)</div>
<div class="line"> </div>
<div class="line">    alt no Profiles matching criteria</div>
<div class="line">    rect rgb(128,202,255)</div>
<div class="line">        ChargePoint--&gt;&gt;CSMS : ClearChargingProfileResponse(Unknown) </div>
<div class="line"> </div>
<div class="line">    end</div>
<div class="line">        </div>
<div class="line">    else found matching Profiles</div>
<div class="line">        ChargePoint--&gt;&gt;-CSMS : ClearChargingProfileResponse(Accepted)</div>
<div class="line">    end    </div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
