
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>5.3.19. OCPP1.6 Module &#8212; EVerest  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxdoc.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/contentui.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/contentui.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.3.20. OCPP 2.1 and 2.0.1 Module" href="OCPP201.html" />
    <link rel="prev" title="5.3.18. NxpNfcFrontendTokenProvider" href="NxpNfcFrontendTokenProvider.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="OCPP201.html" title="5.3.20. OCPP 2.1 and 2.0.1 Module"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="NxpNfcFrontendTokenProvider.html" title="5.3.18. NxpNfcFrontendTokenProvider"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">EVerest  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../general/05_existing_modules.html" accesskey="U"><span class="section-number">5. </span>EVerest Module Configurations</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">5.3.19. </span>OCPP1.6 Module</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ocpp1-6-module">
<span id="everest-modules-handwritten-ocpp"></span><h1><span class="section-number">5.3.19. </span>OCPP1.6 Module<a class="headerlink" href="#ocpp1-6-module" title="Permalink to this heading">¬∂</a></h1>
<p>This module implements and integrates OCPP1.6 within EVerest, including all feature profiles defined by the specification. A connection
to a Charging Station Management System (CSMS) can be established by loading this module as part of the EVerest configuration. This module
leverages <a class="reference external" href="https://github.com/EVerest/libocpp">libocpp</a>, EVerest‚Äôs OCPP library.</p>
<p>The EVerest config <a class="reference external" href="../../config/config-sil-ocpp.yaml">config-sil-ocpp.yaml</a> serves as an example for how to add the OCPP module to
your EVerest config.</p>
<section id="module-configuration">
<h2><span class="section-number">5.3.19.1. </span>Module configuration<a class="headerlink" href="#module-configuration" title="Permalink to this heading">¬∂</a></h2>
<p>Like for every EVerest module, the configuration parameters are defined as part of the module <a class="reference external" href="manifest.yaml">manifest</a>. This module
is a little special though. The OCPP1.6 protocol defines a lot of standardized configuration keys that are used as part of the functional
requirements of the specification. These configuration keys mainly influence the control flow of libocpp and are managed by a separate
JSON configuration file. The module uses the configuration parameter <strong>ChargePointConfigPath</strong> to point to this file.</p>
<p><a class="reference external" href="https://everest.github.io/nightly/tutorials/how_to_ocpp/index.html">This EVerest OCPP tutorial</a>, the OCPP specification, and
<a class="reference external" href="https://github.com/EVerest/libocpp">libocpp‚Äôs documentation</a> are great resources to learn about the different configuration options.</p>
</section>
<section id="integration-in-everest">
<h2><span class="section-number">5.3.19.2. </span>Integration in EVerest<a class="headerlink" href="#integration-in-everest" title="Permalink to this heading">¬∂</a></h2>
<p>This module leverages <a class="reference external" href="https://github.com/EVerest/libocpp">libocpp</a>, EVerest‚Äôs OCPP library. Libocpp‚Äôs approach to implementing the
OCPP protocol is to do as much work as possible as part of the library. It therefore fulfills a large amount of protocol requirements
internally. OCPP is a protocol that affects, controls, and monitors many areas of a charging station‚Äôs operation, though. It is therefore
required to integrate libocpp with other parts of EVerest. This integration is done by this module and will be explained in this section.</p>
<p>For a detailed description of libocpp and its functionalities, please refer to <a class="reference external" href="https://github.com/EVerest/libocpp">its documentation</a>.</p>
<p>The <a class="reference external" href="manifest.yaml">manifest</a> of this module defines requirements and implementations of EVerest interfaces to integrate the OCPP
communication with other parts of EVerest. In order to describe how the responsibilities for functions and operations required by OCPP
are divided between libocpp and this module, the following sections pick up the requirements of this module and implementations one by one.</p>
<section id="provides-main">
<h3><span class="section-number">5.3.19.2.1. </span>Provides: main<a class="headerlink" href="#provides-main" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../interfaces/ocpp_1_6_charge_point.yaml">ocpp_1_6_charge_point</a></p>
<p>This interface is implemented to provide an API to control the websocket connection and to control and retrieve OCPP-specific data like
security events and configuration keys.</p>
<p><em>Note: This interface is deprecated soon and will be removed soon. The functionality is already covered by the generic interface</em>
<a class="reference external" href="../interfaces/ocpp.yaml">ocpp</a> <em>which is used by this module and OCPP201.</em></p>
</section>
<section id="provides-auth-validator">
<h3><span class="section-number">5.3.19.2.2. </span>Provides: auth_validator<a class="headerlink" href="#provides-auth-validator" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../interfaces/auth_token_validator.yaml">auth_token_validator</a></p>
<p>This interface is implemented to forward authorization requests from EVerest to libocpp. Libocpp contains the business logic to either
validate the authorization request locally using the authorization cache and local authorization list or to forward the request to the
CSMS using an <strong>Authorize.req</strong>. The implementation also covers the validation of Plug&amp;Charge authorization requests by triggering a
<cite>DataTransfer.req(Authorize)</cite>.</p>
</section>
<section id="provides-auth-provider">
<h3><span class="section-number">5.3.19.2.3. </span>Provides: auth_provider<a class="headerlink" href="#provides-auth-provider" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../../interfaces/auth_token_provider.yaml">auth_token_provider</a></p>
<p>This interface is implemented to publish authorization requests from the CSMS within EVerest. An authorization request from the CSMS is
turned out by a <strong>RemoteStartTransaction.req</strong>.</p>
</section>
<section id="provides-data-transfer">
<h3><span class="section-number">5.3.19.2.4. </span>Provides: data_transfer<a class="headerlink" href="#provides-data-transfer" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../../interfaces/ocpp_data_transfer.yaml">ocpp_data_transfer</a></p>
<p>This interface is implemented to provide a command to initiate a <strong>DataTransfer.req</strong> from the charging station to the CSMS.</p>
</section>
<section id="provides-ocpp-generic">
<h3><span class="section-number">5.3.19.2.5. </span>Provides: ocpp_generic<a class="headerlink" href="#provides-ocpp-generic" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../../interfaces/ocpp.yaml">ocpp</a></p>
<p>This interface is implemented to provide an API to control an OCPP service and to set and get OCPP-specific data.</p>
</section>
<section id="provides-session-cost">
<h3><span class="section-number">5.3.19.2.6. </span>Provides: session_cost<a class="headerlink" href="#provides-session-cost" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../../interfaces/session_cost.yaml">session_cost</a></p>
<p>This interface is implemented to publish session costs received by the CSMS as part of the California Pricing whitepaper extension.</p>
</section>
<section id="requires-evse-manager">
<h3><span class="section-number">5.3.19.2.7. </span>Requires: evse_manager<a class="headerlink" href="#requires-evse-manager" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../../interfaces/evse_manager.yaml">evse_manager</a></p>
<p>Typically the <a class="reference external" href="../EvseManager/">EvseManager</a> module is used to fulfill this requirement.</p>
<p>This module requires (1-128) implementations of this interface in order to integrate with the charge control logic of EVerest. One
connection represents one EVSE. In order to manage multiple EVSEs via one OCPP connection, multiple connections need to be configured
in the EVerest config file.</p>
<p>This module makes use of the following commands of this interface:</p>
<ul class="simple">
<li><p><strong>get_evse</strong> to get the EVSE id of the module implementing the <strong>evse_manager</strong> interface at startup</p></li>
<li><p><strong>pause_charging</strong> to pause charging in case a <strong>StopTransaction.conf</strong> indicates charging shall be paused</p></li>
<li><p><strong>resume_charging</strong> to resume charging</p></li>
<li><p><strong>stop_transaction</strong> to stop a transaction in case the CSMS stops a transaction by e.g. a <strong>RemoteStopTransaction.req</strong></p></li>
<li><p><strong>force_unlock</strong> to force the unlock of a connector in case the CSMS sends a <strong>UnlockConnector.req</strong></p></li>
<li><p><strong>enable_disable</strong> to set the EVSE to operative or inoperative, e.g., in case the CSMS sends a <strong>ChangeAvailability.req</strong>. This command can
be called from different sources. It therefore contains an argument <strong>priority</strong> in order to override the status if required. OCPP uses
a priority of 5000, which is mid-range.</p></li>
<li><p><strong>set_external_limits</strong> to apply a power or ampere limits at the EVSE received by the CSMS using the SmartCharging feature profile.
Libocpp contains the business logic to calculate the composite schedule for received charging profiles. This module gets notified in
case charging profiles are added, changed, or cleared. When notified, this module requests the composite schedule from libocpp and
publishes the result via the <a class="reference external" href="#provides-ocpp_generic">Provides: ocpp_generic</a> interface. The duration of the composite schedule can
be configured by the configuration parameter <strong>PublishChargingScheduleDurationS</strong> of this module. The configuration parameter
<strong>PublishChargingScheduleIntervalS</strong> defines the interval to use to periodically retrieve and publish the composite schedules.</p></li>
<li><p><strong>external_ready_to_start_charging</strong>: To signal that the module has started to establish an OCPP connection to the CSMS</p></li>
</ul>
<p>The interface is used to receive the following variables:</p>
<ul class="simple">
<li><p><strong>powermeter</strong> to push powermeter values of an EVSE. Libocpp initiates <strong>MeterValues.req</strong> internally and is responsible to comply with
the configured intervals and measurands for clock-aligned and sampled meter values.</p></li>
<li><p><strong>ev_info</strong> to obtain the state of charge (SoC) of an EV. If present, this is reported as part of a <strong>MeterValues.req</strong></p></li>
<li><p><strong>limits</strong> to obtain the current offered to the EV. If present, this is reported as part of a <strong>MeterValues.req</strong></p></li>
<li><p><strong>session_event</strong> to trigger <strong>StatusNotification.req</strong>, <strong>StartTransaction.req</strong>, and <strong>StopTransaction.req</strong> based on the reported event.
This signal drives the state machine and the transaction handling of libocpp.</p></li>
<li><p><strong>waiting_for_external_ready</strong> to obtain the information that a module implementing this interface is waiting for an external ready signal</p></li>
<li><p><strong>ready</strong> to obtain a ready signal from a module implementing this interface</p></li>
</ul>
</section>
<section id="requires-connector-zero-sink">
<h3><span class="section-number">5.3.19.2.8. </span>Requires: connector_zero_sink<a class="headerlink" href="#requires-connector-zero-sink" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../../interfaces/external_energy_limits.yaml">external_energy_limits</a></p>
<p>Typically the <a class="reference external" href="../EnergyNode/">EnergyNode</a> module is used to fulfill this requirement.</p>
<p>This module optionally requires the connection to a module implementing the <strong>external_energy_limits</strong> interface. This connection is used
to apply power or ampere limits at EVSE id zero received by the CSMS using the SmartCharging feature profile.</p>
<p>This module makes use of the following commands of this interface:</p>
<ul class="simple">
<li><p><strong>set_external_limits</strong> to apply a power or ampere limits for EVSE id zero (the whole charging station).</p></li>
</ul>
</section>
<section id="requires-reservation">
<h3><span class="section-number">5.3.19.2.9. </span>Requires: reservation<a class="headerlink" href="#requires-reservation" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../../interfaces/reservation.yaml">reservation</a></p>
<p>Typically the <a class="reference external" href="../Auth/">Auth</a> module is used to fulfill this requirement.</p>
<p>This module requires a connection to a module implementing the <cite>reservation</cite> interface. This connection is used to apply reservation
requests from the CSMS.</p>
<p>This module makes use of the following commands of this interface:</p>
<ul class="simple">
<li><p><strong>reserve_now</strong> which is called when the CSMS sends a <strong>ReserveNow.req</strong></p></li>
<li><p><strong>cancel_reservation</strong> which is called when the CSMS sends a <strong>CancelReservation.req</strong></p></li>
</ul>
</section>
<section id="requires-auth">
<h3><span class="section-number">5.3.19.2.10. </span>Requires: auth<a class="headerlink" href="#requires-auth" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../../interfaces/auth.yaml">auth</a></p>
<p>Typically the <a class="reference external" href="../Auth/">Auth</a> module is used to fulfill this requirement.</p>
<p>This module requires a connection to a module implementing the <strong>auth</strong> interface. This connection is used to set the standardized
<strong>ConnectionTimeout</strong> configuration key if configured and/or changed by the CSMS.</p>
<p>This module makes use of the following commands of this interface:</p>
<ul class="simple">
<li><p><strong>set_connection_timeout</strong> which is e.g., called in case the CSMS uses a <strong>ChangeConfiguration.req(ConnectionTimeout)</strong></p></li>
</ul>
</section>
<section id="requires-system">
<h3><span class="section-number">5.3.19.2.11. </span>Requires: system<a class="headerlink" href="#requires-system" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../../interfaces/system.yaml">system</a></p>
<p>The <a class="reference external" href="../System/">System</a> module can be used to fulfill this requirement. Note that this module is not meant to be used in
production systems without any modification!</p>
<p>This module requires a connection to a module implementing the <strong>system</strong> interface. This connection is used to execute and control
system-wide operations that can be triggered by the CSMS, like log uploads, firmware updates, and resets.</p>
<p>This module makes use of the following commands of this interface:</p>
<ul class="simple">
<li><p><strong>update_firmware</strong> to forward <strong>UpdateFirmware.req</strong> or <strong>SignedUpdateFirmware.req</strong> messages from the CSMS</p></li>
<li><p><strong>allow_firmware_installation</strong> to notify the module that the installation of the firmware is now allowed. A prerequisite for this
is that all EVSEs are set to inoperative. This module and libocpp take care of setting the EVSEs to inoperative before calling
this command.</p></li>
<li><p><strong>upload_logs</strong> to forward <strong>GetDiagnostics.req</strong> or <strong>GetLog.req</strong> messages from the CSMS</p></li>
<li><p><strong>is_reset_allowed</strong> to check if a <strong>Reset.req</strong> message from the CSMS shall be accepted or rejected</p></li>
<li><p><strong>reset</strong> to perform a reset in case of a <strong>Reset.req</strong> message from the CSMS</p></li>
<li><p><strong>set_system_time</strong> to set the system time communicated by a <strong>BootNotification.conf</strong> or <strong>Heartbeat.conf</strong> messages from the CSMS</p></li>
<li><p><strong>get_boot_reason</strong> to obtain the boot reason to use it as part of the <strong>BootNotification.req</strong> at startup</p></li>
</ul>
<p>The interface is used to receive the following variables:</p>
<ul class="simple">
<li><p><strong>log_status</strong> to obtain the log update status. This triggers a <strong>LogStatusNotification.req</strong> or <strong>DiagnosticsStatusNotification.req</strong>
message to inform the CSMS about the current status. This signal is expected as a result of an <strong>upload_logs</strong> command.</p></li>
<li><p><strong>firmware_update_status</strong> to obtain the firmware update status. This triggers a <strong>FirmwareStatusNotification.req</strong> or
<strong>SignedFirmwareStatusNotification.req</strong> message to inform the CSMS about the current status. This signal is expected as a result
of an <strong>update_firmware</strong> command.</p></li>
</ul>
</section>
<section id="requires-security">
<h3><span class="section-number">5.3.19.2.12. </span>Requires: security<a class="headerlink" href="#requires-security" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../../interfaces/evse_security.yaml">evse_security</a></p>
<p>This module requires a connection to a module implementing the <cite>evse_security</cite> interface. This connection is used to execute
security-related operations and to manage certificates and private keys.</p>
<p>Typically the <a class="reference external" href="../EvseSecurity/">EvseSecurity</a> module is used to fulfill this requirement.</p>
<p>This module makes use of the following commands of this interface:</p>
<ul class="simple">
<li><p><strong>install_ca_certificate</strong> to handle <strong>InstallCertificate.req</strong> and <a href="#id8"><span class="problematic" id="id9">**</span></a>DataTransfer.req(InstallCertificate) messages from the CSMS</p></li>
<li><p><strong>delete_certificate</strong> to handle <strong>DeleteCertificate.req</strong> and <strong>DataTransfer.req(DeleteCertificate)</strong> messages from the CSMS</p></li>
<li><p><strong>update_leaf_certificate</strong> to handle <strong>CertificateSigned.req</strong> and <a href="#id10"><span class="problematic" id="id11">**</span></a>DataTransfer.req(CertificateSigned) messages from the CSMS</p></li>
<li><p><strong>verify_certificate</strong> to verify certificates from the CSMS that are sent as part of <strong>SignedUpdateFirmware.req</strong></p></li>
<li><p><strong>get_installed_certificates</strong> to handle <strong>GetInstalledCertificateIds.req</strong> and <strong>DataTransfer.req(GetInstalledCertificateIds)</strong>
messages from the CSMS</p></li>
<li><p><strong>get_v2g_ocsp_request_data</strong> to update the OCSP cache of V2G sub-CA certificates using a <strong>DataTransfer.req(GetCertificateStatus)</strong>.
Triggering this message is handled by libocpp internally</p></li>
<li><p><strong>get_mo_ocsp_request_data</strong> to include the <strong>iso15118CertificateHashData</strong> as part of a <strong>DataTransfer.req(Authorize)</strong> for Plug&amp;Charge
if required</p></li>
<li><p><strong>update_ocsp_cache</strong> to update the OCSP cache which is part of a <strong>DataTransfer.conf(GetCertificateStatus)</strong> message from the CSMS</p></li>
<li><p><strong>is_ca_certificate_installed</strong> to verify if a certain CA certificate is installed</p></li>
<li><p><strong>generate_certificate_signing_request</strong> to generate a CSR that can be used as part of a <strong>SignCertificate.req</strong> and
<cite>DataTransfer.req(SignCertificate)</cite> message to the CSMS.</p></li>
<li><p><strong>get_leaf_certificate_info</strong> to get the certificate and private key path of the CSMS client certificate used for security profile 3.</p></li>
<li><p><strong>get_verify_file</strong> to get the path to a CA bundle that can be used for verifying, e.g., the CSMS TLS server certificate</p></li>
<li><p><strong>get_leaf_expiry_days_count</strong> to determine when a leaf certificate expires. This information is used by libocpp in order to renew
leaf certificates in case they expire soon</p></li>
</ul>
<p>Note that a lot of conversion between the libocpp types and the generated EVerest types are required for the given commands. Since the
conversion functionality is used by this OCPP module and the OCPP201 module, it is implemented as a
<a class="reference external" href="../../../../../lib/everest/conversions/ocpp/">separate library</a> .</p>
</section>
<section id="requires-data-transfer">
<h3><span class="section-number">5.3.19.2.13. </span>Requires: data_transfer<a class="headerlink" href="#requires-data-transfer" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../../interfaces/ocpp_data_transfer.yaml">ocpp_data_transfer</a></p>
<p>This module optionally requires a connection to a module implementing the <strong>ocpp_data_transfer</strong> interface. This connection is used to
handle <strong>DataTransfer.req</strong> messages from the CSMS. A module implementing this interface can contain custom logic to handle the requests
from the CSMS.</p>
<p>This module makes use of the following commands of this interface:</p>
<ul class="simple">
<li><p><strong>data_transfer</strong> to forward <strong>DataTransfer.req</strong> messages from the CSMS</p></li>
</ul>
</section>
<section id="requires-display-message">
<h3><span class="section-number">5.3.19.2.14. </span>Requires: display_message<a class="headerlink" href="#requires-display-message" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../../interfaces/display_message.yaml">display_message</a></p>
<p>This module optionally requires a connection to a module implementing the <strong>display_message</strong> interface. This connection is used to allow
the CSMS to display pricing or other information on the display of a charging station.</p>
<p>This module makes use of the following commands of this interface:</p>
<ul class="simple">
<li><p><strong>set_display_message</strong> to set a message on the charging station‚Äôs display. This is executed when the CSMS sends a</p></li>
</ul>
</section>
<section id="requires-extensions-15118">
<h3><span class="section-number">5.3.19.2.15. </span>Requires: extensions_15118<a class="headerlink" href="#requires-extensions-15118" title="Permalink to this heading">¬∂</a></h3>
<p><strong>Interface</strong>: <a class="reference external" href="../../interfaces/iso15118_extensions.yaml">iso15118_extensions</a></p>
<p>This module optionally requires (0-128) implementations of this interface in order to share data between ISO15118 and OCPP modules. One
connection represents one ISO15118 module.</p>
<p>This module makes use of the following commands of this interface:</p>
<ul class="simple">
<li><p><strong>set_get_certificate_response</strong> to report that the charging station received a <strong>DataTransfer.conf(Get15118EVCertificateResponse)</strong> from
the CSMS (EV Contract installation for Plug&amp;Charge)</p></li>
</ul>
<p>The interface is used to receive the following variables:</p>
<ul class="simple">
<li><p><strong>iso15118_certificate_request</strong> to trigger a <strong>DataTransfer.req(Get15118EVCertificateRequest)</strong> as part of the Plug&amp;Charge process</p></li>
</ul>
</section>
</section>
<section id="global-errors-and-error-reporting">
<h2><span class="section-number">5.3.19.3. </span>Global Errors and Error Reporting<a class="headerlink" href="#global-errors-and-error-reporting" title="Permalink to this heading">¬∂</a></h2>
<p>The <strong>enable_global_errors</strong> flag for this module is enabled in its manifest. This module is therefore able to retrieve and process all reported errors
from other modules loaded in the same EVerest configuration.</p>
<p>In OCPP1.6 errors can be reported using the <strong>StatusNotification.req</strong> message. If this module gets notified about a raised error,
it initiates a <strong>StatusNotification.req</strong> that contains information about the error that has been raised.</p>
<p>The field <strong>status</strong> of the <strong>StatusNotification.req</strong> will be set to faulted only in case the error is of the special type
<strong>evse_manager/Inoperative</strong>. The field <strong>connectorId</strong> is set based on the mapping (for EVSE id and connector id) of the origin of the error.
If no mapping is provided, the error will be reported on connectorId 0. Note that the mapping can be configured per module inside the
EVerest config file.</p>
<p>For all other errors, raised in EVerest, the following mapping to an
OCPP <strong>StatusNotification.req</strong> will be used:</p>
<ul class="simple">
<li><p><strong>StatusNotification.req</strong> property <code class="docutils literal notranslate"><span class="pre">errorCode</span></code> will always be
<code class="docutils literal notranslate"><span class="pre">OtherError</span></code></p></li>
<li><p><strong>StatusNotification.req</strong> property <code class="docutils literal notranslate"><span class="pre">status</span></code> will reflect the present status of the
charge point</p></li>
<li><p><strong>StatusNotification.req</strong> property <code class="docutils literal notranslate"><span class="pre">info</span></code> -&gt; origin of EVerest error</p></li>
<li><p><strong>StatusNotification.req</strong> property <code class="docutils literal notranslate"><span class="pre">vendorErrorCode</span></code> -&gt; EVerest error type and
subtype (the error type is simplified, meaning, that its leading part,
the interface name, is stripped)</p></li>
<li><p><strong>StatusNotification.req</strong> property <code class="docutils literal notranslate"><span class="pre">vendorId</span></code> -&gt; EVerest error message</p></li>
</ul>
<p>The reason for using the <strong>StatusNotification.req</strong> property property
<code class="docutils literal notranslate"><span class="pre">vendorId</span></code> for the error message is that it can carry the largest
string (255 characters), whereas the other fields (<code class="docutils literal notranslate"><span class="pre">info</span></code> and
<code class="docutils literal notranslate"><span class="pre">vendorErrorCode</span></code>) only allow up to 50 characters.</p>
<p>If for example the module with id <cite>yeti_driver</cite> within its
implementation with id <cite>board_support</cite> creates the following error:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">error_factory</span><span class="o">-&gt;</span><span class="n">create_error</span><span class="p">(</span><span class="s">&quot;evse_board_support/EnergyManagement&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;OutOfEnergy&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;someone cut the wires&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>the corresponding fields in the <strong>StatusNotification.req</strong> message will
look like this:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;info&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;yeti_driver-&gt;board_support&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;vendorErrorCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;EnergyManagement/OutOfEnergy&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;vendorId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;someone cut the wires&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <strong>StatusNotification.req</strong> message has some limitations with respect
to reporting errors:</p>
<ul class="simple">
<li><p>Single errors cannot simply be cleared. If multiple errors are raised,
it is not possible to clear individual errors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vendorId</span></code>, <code class="docutils literal notranslate"><span class="pre">info</span></code> and <code class="docutils literal notranslate"><span class="pre">vendorErrorCode</span></code> are limited in length
(see above).</p></li>
</ul>
<p>This module attempts to follow the Minimum Required Error Codes (MRECS): <a class="reference external" href="https://inl.gov/chargex/mrec/">https://inl.gov/chargex/mrec/</a>. This proposes a unified
methodology to define and classify a minimum required set of error codes and how to report them via OCPP1.6.</p>
<p>This module currently deviates from the MREC specification in the following points:</p>
<ul class="simple">
<li><p>Simultaneous errors: MREC requires reporting simultaneous errors by reporting them in a single <strong>StatusNotification.req</strong> by separating
the information of the fields <strong>vendorId</strong> and <strong>info</strong> by a semicolon. This module sends one <strong>StatusNotification.req</strong> per individual error
because of the limited maximum characters of the <strong>info</strong> field.</p></li>
<li><p>MREC requires always using the value <strong>Faulted</strong> for the <strong>status</strong> field when reporting an error. The OCPP1.6 specification defines the
<strong>Faulted</strong> value as follows: ‚ÄúWhen a Charge Point or connector has reported an error and is not available for energy delivery.
(Inoperative).‚Äù This module, therefore, only reports <strong>Faulted</strong> when the Charge Point is not available for energy delivery.</p></li>
</ul>
</section>
<section id="energy-management-and-smart-charging-integration">
<h2><span class="section-number">5.3.19.4. </span>Energy Management and Smart Charging Integration<a class="headerlink" href="#energy-management-and-smart-charging-integration" title="Permalink to this heading">¬∂</a></h2>
<p>OCPP1.6 defines the SmartCharging feature profile to allow the CSMS to control or influence the power consumption of the charging station.
This module integrates the composite schedule(s) within EVerest‚Äôs energy management. For further information about smart charging and the
composite schedule calculation please refer to the OCPP1.6 specification.</p>
<p>The integration of the composite schedules is implemented through the optional requirement(s) <cite>evse_energy_sink</cite> (interface: <cite>external_energy_limits</cite>)
of this module. Depending on the number of EVSEs configured, each composite limit is communicated via a seperate sink, including the composite schedule
for EVSE with id 0 (representing the whole charging station). The easiest way to explain this is with an example. If your charging station
has two EVSEs you need to connect three modules that implement the <cite>external_energy_limits</cite> interface: One representing evse id 0 and
two representing your actual EVSEs.</p>
<p>üìå <strong>Note:</strong> You have to configure an evse mapping for each module connected via the evse_energy_sink connection. This allows the module to identify
which requirement to use when communicating the limits for the EVSEs. For more information about the module mapping please see
<a class="reference external" href="https://everest.github.io/nightly/general/05_existing_modules.html#tier-module-mappings">3-tier module mappings</a>.</p>
<p>This module defines a callback that gets executed every time charging profiles are changed, added or removed by the CSMS. The callback retrieves
the composite schedules for all EVSEs (including evse id 0) and calls the <cite>set_external_limits</cite> command of the respective requirement that implements
the <cite>external_energy_limits</cite> interface. In addition, the config parameter <cite>PublishChargingScheduleIntervalS</cite> defines a periodic interval to retrieve
the composite schedule also in case no charging profiles have been changed. The configuration parameter <cite>PublishChargingScheduleDurationS</cite> defines
the duration in seconds of the requested composite schedules starting now. The value configured for <cite>PublishChargingScheduleDurationS</cite> shall be greater
than the value configured for <cite>PublishChargingScheduleIntervalS</cite> because otherwise time periods could be missed by the application.</p>
</section>
<section id="certificate-management">
<h2><span class="section-number">5.3.19.5. </span>Certificate Management<a class="headerlink" href="#certificate-management" title="Permalink to this heading">¬∂</a></h2>
<p>Two leaf certificates are managed by the OCPP communication enabled by this module:</p>
<ul class="simple">
<li><p>CSMS Leaf certificate (used for mTLS for SecurityProfile3)</p></li>
<li><p>SECC Leaf certificate (Server certificate for ISO15118)</p></li>
</ul>
<p>60 seconds after the first <strong>BootNotification.req</strong> message has been accepted by the CSMS, the charging station will check if the existing
certificates are not present or have been expired. If this is the case, the charging station initiates the process of requesting a new
certificate by sending a certificate signing request to CSMS.</p>
<p>For the CSMS Leaf certificate, this process is only triggered if SecurityProfile 3 is used.</p>
<p>For the SECC Leaf certificate, this process is only triggered if Plug&amp;Charge is enabled by setting the <strong>ISO15118CertificateManagementEnabled</strong> to <strong>true</strong>.</p>
<p>If a certificate has expired is then periodically checked every 12 hours.</p>
<p>In addition to that, the charging station periodically updates the OCSP responses of the sub-CA certificates of the V2G certificate chain.
The OCSP response is cached and can be used as part of the ISO15118 TLS handshake with EVs. The OCSP update is by default performed
every seven days (or can be configured using the <strong>OCSPRequestInterval</strong> configuration key).
The timestamp of the last update is stored persistently, so that this process is not necessarily performed at every start up.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../general/01_framework/index.html">1. EVerest Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/02_detail_pre_setup.html">2. Prepare Your Development Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/03_quick_start_guide.html">3. A Kind Of Quick Guide To EVerest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/04_detail_module_concept.html">4. EVerest Modules in Detail</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../general/05_existing_modules.html">5. EVerest Module Configurations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../general/05_existing_modules.html#module-connections-for-dedicated-use-cases">5.1. Module connections for dedicated use cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../general/05_existing_modules.html#tier-module-mappings">5.2. 3-tier module mappings</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../general/05_existing_modules.html#module-functionality-in-detail">5.3. Module functionality in detail</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../general/06_handling_bank_cards.html">6. Bank Card Payment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/07_configure_plug_and_charge.html">7. Configure Plug&amp;Charge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_tools/index.html">8. EVerest development tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">9. Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/faq.html">10. Frequently Asked Questions And Best Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hardware/pionix_belay_box.html">11. Pionix BelayBox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/02_snapshot.html">12. Snapshot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/01_everest_reference/index.html">13. EVerest Reference</a></li>
</ul>

  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="NxpNfcFrontendTokenProvider.html"
                          title="previous chapter"><span class="section-number">5.3.18. </span>NxpNfcFrontendTokenProvider</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="OCPP201.html"
                          title="next chapter"><span class="section-number">5.3.20. </span>OCPP 2.1 and 2.0.1 Module</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/_included/modules_doc/OCPP.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div><h3>Community</h3>
<ul class="nav nav-sidebar">
<li><a href="https://lists.lfenergy.org/g/everest" target="_blank"><img src="../../_static/icons/mail.svg" style="height: 0.8em" /> Get Support</a></li>
<li><a href="https://www.youtube.com/@lfe_everest" target="_blank"><img src="../../_static/icons/youtube.svg" style="height: 0.8em" /> YouTube Channel</a></li>
<li><a href="https://twitter.com/everestincharge" target="_blank"><img src="../../_static/icons/twitter.svg" style="height: 0.8em" /> Twitter</a></li>
<li><a href="https://fosstodon.org/@EVerest" target="_blank">Mastodon</a></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="OCPP201.html" title="5.3.20. OCPP 2.1 and 2.0.1 Module"
             >next</a> |</li>
        <li class="right" >
          <a href="NxpNfcFrontendTokenProvider.html" title="5.3.18. NxpNfcFrontendTokenProvider"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">EVerest  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../general/05_existing_modules.html" ><span class="section-number">5. </span>EVerest Module Configurations</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">5.3.19. </span>OCPP1.6 Module</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Pionix GmbH.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>