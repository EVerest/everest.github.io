
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>How To: Develop New Modules &#8212; EVerest  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css" />
    <link rel="stylesheet" type="text/css" href="_static/contentui.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/contentui.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">EVerest  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">How To: Develop New Modules</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="how-to-develop-new-modules">
<h1>How To: Develop New Modules<a class="headerlink" href="#how-to-develop-new-modules" title="Permalink to this headline">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In this example we use Visual Basic Code, but every other programming editor is equivalent to develop inside the everest framework.
The best beginning to create new packages is to create them directly inside the project and understand the basics and rules to create a stable package.
Working with the github repository is the safest solution to get the acual version of the framework and all the functionalities of the EVerst Charging Station.
For a fluid workaround it is recommended adding an ssh-key, like its discribed inside the github documentation <a class="reference external" href="https://docs.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">https://docs.github.com/en/github/authenticating-to-github/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent</a>.
With an ssh-key you do not need to reenter your credentials for every pull of your infranet workspace.</p>
<p>After understanding the concept of the framework, descirbed in the following documentation:<strong>Here comes a link</strong>
, you can start to create your own new additions or recrate the existing modules/units with your own implementations.</p>
<p>Don’t forget by recreating modules to provide the required signals to other modules, which is possible to check by comparing your outcomes
with the classdiagram of the basic enviroment: <strong>Here comes a link</strong></p>
<p>As an example a new module called <strong>PowerLaboratory</strong> will be now generated in the modules-directory.</p>
<section id="new-directory">
<h3>1. New directory<a class="headerlink" href="#new-directory" title="Permalink to this headline">¶</a></h3>
<p>With a right-click on the modules-directory there is the option “New Folder”. With this it is needed to create a folder with the name of your module
written in camelcase.</p>
</section>
<section id="creating-the-essential-files">
<h3>2. Creating the essential files<a class="headerlink" href="#creating-the-essential-files" title="Permalink to this headline">¶</a></h3>
<p>With right-click on your new module-folder you have to create new files as the essential components
The __init__.py, the manifest.json and the unit-script written in python</p>
</section>
<section id="define-the-init-py">
<h3>4. Define the __init__.py<a class="headerlink" href="#define-the-init-py" title="Permalink to this headline">¶</a></h3>
<p>The __init__.py declare the Class, also named with camelcase as ModuleMain which is required to start the module through the command line.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">LogManager</span>
<span class="linenos">2</span><span class="n">logger</span> <span class="o">=</span> <span class="n">LogManager</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="linenos">3</span><span class="k">del</span> <span class="n">LogManager</span>
<span class="linenos">4</span><span class="kn">from</span> <span class="nn">.power_laboratory</span> <span class="kn">import</span> <span class="n">PowerLaboratory</span> <span class="k">as</span> <span class="n">ModuleMain</span>
</pre></div>
</div>
</section>
<section id="define-the-manifest-json">
<h3>5. Define the manifest.json<a class="headerlink" href="#define-the-manifest-json" title="Permalink to this headline">¶</a></h3>
<p>The manifest of the module declares the units with unit_ids. Because the modules only provides one module and it was declared as the main module,
the name of the unit is simply defined as “main” which provides the class which will be declared in the python script. As an additional requirement,
the licence and the name of the author should be a part of the manifest.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span>    <span class="s2">&quot;provides&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos"> 3</span>        <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos"> 4</span>            <span class="s2">&quot;class&quot;</span><span class="o">:</span> <span class="s2">&quot;power_laboratory&quot;</span>
<span class="linenos"> 5</span>        <span class="p">}</span>
<span class="linenos"> 6</span>    <span class="p">},</span>
<span class="linenos"> 7</span>    <span class="s2">&quot;metadata&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos"> 8</span>        <span class="s2">&quot;license&quot;</span><span class="o">:</span> <span class="s2">&quot;https://opensource.org/licenses/MIT&quot;</span><span class="p">,</span>
<span class="linenos"> 9</span>        <span class="s2">&quot;author&quot;</span><span class="o">:</span> <span class="s2">&quot;Your Name&quot;</span>
<span class="linenos">10</span>    <span class="p">}</span>
<span class="linenos">11</span><span class="p">}</span>
</pre></div>
</div>
<p>If the module requires connections to variables or commands to other unit-classes then its is necessary to define these requirements with a suitable
lowcased requirement-name.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span>    <span class="nt">&quot;provides&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 3</span>        <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 4</span>            <span class="nt">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;power_laboratory&quot;</span>
<span class="linenos"> 5</span>        <span class="p">}</span>
<span class="linenos"> 6</span>    <span class="p">},</span>
<span class="linenos"> 7</span>    <span class="nt">&quot;requires&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 8</span>        <span class="nt">&quot;reqpower&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 9</span>            <span class="nt">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;Power&quot;</span>
<span class="linenos">10</span>        <span class="p">}</span>
<span class="linenos">11</span>    <span class="p">},</span>
<span class="linenos">12</span>    <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">13</span>        <span class="nt">&quot;license&quot;</span><span class="p">:</span> <span class="s2">&quot;https://opensource.org/licenses/MIT&quot;</span><span class="p">,</span>
<span class="linenos">14</span>        <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;Hubert Padusinski&quot;</span>
<span class="linenos">15</span>    <span class="p">}</span>
<span class="linenos">16</span><span class="p">}</span>
</pre></div>
</div>
<p>The main unit can provide different configurations and interfaces as variables and commands to other units. For more structure inside the EVerest-enviroment,
the order should be followed in as “config”, “vars” and then “commands”.Configs can be declared as internal inital constants or a list with propterties for
a specific unit. They can be embedded inside the python script and in the manifest contains the restrictions. Restrictions are mimimal declared by the type of
the object and typically can includes the allowed characters in id’s, names or messages, minmum, maximum values. An overview of options gives the
<strong>Here comes a link:framework-library</strong></p>
<p>It is optionally possible to set a default value for the config, but usually all configuration values have to be declared inside the config.json.
Providing Variables as “vars” are described by keeping the style of the configs, but are not declared in the config.json.
A command can be empty or bring along input keys. The commands as “cmds” are declared in the manifest with the possiblity to contain restricted
arguments by type or value limits and also declare the rules of an expected result.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span>    <span class="nt">&quot;provides&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 3</span>        <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 4</span>            <span class="nt">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;power_laboratory&quot;</span><span class="p">,</span>
<span class="linenos"> 5</span>            <span class="nt">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 6</span>                <span class="nt">&quot;max_current&quot;</span><span class="p">:{</span>
<span class="linenos"> 7</span>                    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Provides maximum current of this supply in ampere&quot;</span><span class="p">,</span>
<span class="linenos"> 8</span>                    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span>
<span class="linenos"> 9</span>                    <span class="nt">&quot;minumum&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos">10</span>                    <span class="nt">&quot;maximum&quot;</span><span class="p">:</span> <span class="mi">60</span>
<span class="linenos">11</span>                <span class="p">},</span>
<span class="linenos">12</span>            <span class="p">},</span>
<span class="linenos">13</span>            <span class="nt">&quot;vars&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">14</span>                <span class="nt">&quot;max_current&quot;</span><span class="p">:{</span>
<span class="linenos">15</span>                    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Provides maximum current of this supply in ampere&quot;</span><span class="p">,</span>
<span class="linenos">16</span>                    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span>
<span class="linenos">17</span>                <span class="p">},</span>
<span class="linenos">18</span>            <span class="p">}</span>
<span class="linenos">19</span>            <span class="nt">&quot;cmds&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">20</span>                <span class="nt">&quot;start_power_laboratory&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">21</span>                    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This command starts the power &quot;</span><span class="p">,</span>
<span class="linenos">22</span>                    <span class="nt">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">23</span>                        <span class="nt">&quot;start_current&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">24</span>                            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;This argument specifies to charge with the current at start&quot;</span><span class="p">,</span>
<span class="linenos">25</span>                            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">,</span>
<span class="linenos">26</span>                            <span class="nt">&quot;minimum&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="linenos">27</span>                            <span class="nt">&quot;maximum&quot;</span><span class="p">:</span> <span class="mi">60</span>
<span class="linenos">28</span>                        <span class="p">},</span>
<span class="linenos">29</span>                    <span class="p">},</span>
<span class="linenos">30</span>                    <span class="nt">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">31</span>                        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
<span class="linenos">32</span>                    <span class="p">}</span>
<span class="linenos">33</span>                <span class="p">}</span>
<span class="linenos">34</span>            <span class="p">}</span>
<span class="linenos">35</span>        <span class="p">},</span>
<span class="linenos">36</span>        <span class="nt">&quot;requires&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">37</span>            <span class="nt">&quot;reqpower&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">38</span>                <span class="nt">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;Power&quot;</span>
<span class="linenos">39</span>            <span class="p">}</span>
<span class="linenos">40</span>        <span class="p">}</span>
<span class="linenos">41</span>    <span class="p">},</span>
<span class="linenos">42</span>    <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">43</span>        <span class="nt">&quot;license&quot;</span><span class="p">:</span> <span class="s2">&quot;https://opensource.org/licenses/MIT&quot;</span><span class="p">,</span>
<span class="linenos">44</span>        <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;Thilo Molitor&quot;</span>
<span class="linenos">45</span>    <span class="p">}</span>
<span class="linenos">46</span><span class="p">}</span>
</pre></div>
</div>
<p>The <em>power_laboratory</em> class shows examples for the configurations and interfaces.Connections between units can have the same namespacings for configurations and variables,
due to the use of IDs and separate functions, which makes the identification of the interface type self-explanatory.</p>
<blockquote>
<div><p><strong>max_current</strong> as constant</p>
<p>As a constant of the unit power_laboratory is minimal defined with the type as number and optionally declared with minimum and maximum values.
If the vaule in the config is outside the allowed range, the framework will response with an error by starting the enviroment.
The discription allows more intelligibility to understand the sense behind a configuration, but it is optional in use.
Other unit-scripts can also import the configuration of the <em>power_laboratory</em> class.</p>
<p><strong>max_current</strong> as variable</p>
<p>As a variable the unit-script of power_laboratory is able to publish it with an publish-function <em>everest.publish_var(unit_id, var_name, value)</em>
from the everest framework. The framework checks by publishing the type or restrictions and raises if necessary an error.</p>
<p><strong>start_current</strong> as a command</p>
<p>A unit can provide commands with or without input-keys and optionally results, which also can be defined in types, restricitons, limits or default values.
Inside the unit-script power_laboratory the command needs to be functionally defined and describe the reaction,
through the <em>everest.provide_cmd(unit_id, cmd_name)</em>-function. Another unit can trigger the command by using <em>everest.call_cmd(requirement_id, cmd_name, args)</em>.</p>
</div></blockquote>
</section>
<section id="creating-a-unit-script">
<h3>5. Creating a unit-script<a class="headerlink" href="#creating-a-unit-script" title="Permalink to this headline">¶</a></h3>
<p>Functionalities are created in python-scripts with a minimal content.
At the beginning the required libraries are imported from async, the utlitys and the framework.
Inside the unit-script, the class with camelcase need to be introduced with minimum the <em>__init__-object</em>, where typically the configs are imported.
Should a unit class begin with starting a routine, then this is realizable by waiting for a <em>everest.ready</em>- signal.</p>
<p>Like it was indicated in the description of the manifest, a variable can be published by using the publish_var-function. In the example of PowerLaboratory,
the max_current is published with the unit_id and the var_name, which they have to be synchronous to the definition in the manifest. In this example the config value
is imported as a global variable and is directly published.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># import python libs</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1"># import needed parts of our framework</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">framework</span> <span class="kn">import</span> <span class="n">everest</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">time</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="k">class</span> <span class="nc">PowerLaboratory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="linenos"> 9</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="linenos">10</span>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Got config: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">config</span><span class="p">))</span>
<span class="linenos">11</span>        <span class="bp">self</span><span class="o">.</span><span class="n">max_current</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;main&quot;</span><span class="p">][</span><span class="s2">&quot;max_current&quot;</span><span class="p">]</span>
<span class="linenos">12</span>
<span class="linenos">13</span>    <span class="nd">@everest</span><span class="o">.</span><span class="n">ready</span>
<span class="linenos">14</span>    <span class="k">def</span> <span class="nf">ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">15</span>        <span class="n">everest</span><span class="o">.</span><span class="n">publish_var</span><span class="p">(</span><span class="n">unit_id</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;max_current&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_current</span><span class="p">)</span>
</pre></div>
</div>
<section id="exercise">
<h4>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">¶</a></h4>
<p><strong>A</strong>
<em>Now you can try to rebuild an new module with essential-scripts in orientation to the PowerLaboratory-Module,
but rename it with a PowerSolar respectively power_solar namespacing.</em></p>
<p><strong>B</strong>
<em>As an example a simple third module called **Power*</em> should be created with its essential scripts, but it has no configs or commands.
It only provides the variable max_current with the same type and restrictions.
In additon it requires PowerLaboratory and PowerSolar.
The python-script is empty*</p>
</section>
</section>
<section id="connecting-modules">
<h3>5. Connecting Modules<a class="headerlink" href="#connecting-modules" title="Permalink to this headline">¶</a></h3>
<p>Now you should have three modules, two that provides a value and the third will now listen on both others.
The script of the Power-unit shows that at the beginning the Power-module just initiate its globale variable of self.max_current and is subscribing the variables of
the PowerLaboratory and PowerSolar modules.
If each of this modules publish a new varable they are saved in the self.max_current-dictionary with an individual key.
Directly the routine jumps to the incoming_current-object, where the the resulting max_current of the power-module is published. Resulting means the minimum value
of the actual registered max_current-values of each connected modules.
The module PowerSolar has a special relation to the PowerModule, because it is declared as <em>optional</em>. This configuration will be introduced in the config.json,
but for generating more selfcontrol and a better understanding of the code, the framework demands the key “optional:”, whenever this module is subscribed.
A missing optional-key results an error.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># import python stuff</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1"># import needed parts of our framework</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">framework</span> <span class="kn">import</span> <span class="n">everest</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">time</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="k">class</span> <span class="nc">Power</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="linenos"> 9</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="linenos">10</span>    <span class="bp">self</span><span class="o">.</span><span class="n">max_current</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">11</span>
<span class="linenos">12</span>    <span class="nd">@everest</span><span class="o">.</span><span class="n">subscribe_var</span><span class="p">(</span><span class="n">requirement_id</span><span class="o">=</span><span class="s2">&quot;powerin&quot;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;max_current&quot;</span><span class="p">)</span>
<span class="linenos">13</span>    <span class="k">def</span> <span class="nf">incoming_current_powerin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_current</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
<span class="linenos">14</span>        <span class="bp">self</span><span class="o">.</span><span class="n">max_current</span><span class="p">[</span><span class="s2">&quot;powerin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_current</span>
<span class="linenos">15</span>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Incoming power_in current: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_current</span><span class="p">))</span>
<span class="linenos">16</span>        <span class="bp">self</span><span class="o">.</span><span class="n">incoming_current</span><span class="p">()</span>
<span class="linenos">17</span>
<span class="linenos">18</span>    <span class="nd">@everest</span><span class="o">.</span><span class="n">subscribe_var</span><span class="p">(</span><span class="n">requirement_id</span><span class="o">=</span><span class="s2">&quot;optional:solar&quot;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;max_current&quot;</span><span class="p">)</span>
<span class="linenos">19</span>    <span class="k">def</span> <span class="nf">incoming_current_solar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_current</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span>
<span class="linenos">20</span>        <span class="bp">self</span><span class="o">.</span><span class="n">max_current</span><span class="p">[</span><span class="s2">&quot;optional:solar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_current</span>
<span class="linenos">21</span>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Incoming solar current: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_current</span><span class="p">))</span>
<span class="linenos">22</span>        <span class="bp">self</span><span class="o">.</span><span class="n">incoming_current</span><span class="p">()</span>
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="k">def</span> <span class="nf">incoming_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">25</span>        <span class="n">everest</span><span class="o">.</span><span class="n">publish_var</span><span class="p">(</span><span class="n">unit_id</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;max_current&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_current</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</pre></div>
</div>
<p>To establish the connection in the enviroment and set the configurations all modules have to be declared and defined in the config.json in the /everst-main-directory.
Configs are part of the unit and gets a valid value, like here for the max_current-configs of the main units of each PowerLaboratory and PowerSolar-modules.
Connections are fullfiled by describing which unit fullfills a requirement an explicit module inside its manifest.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">}</span>
<span class="linenos"> 2</span>    <span class="p">}</span>
<span class="linenos"> 3</span>    <span class="s2">&quot;powerlab&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos"> 4</span>        <span class="s2">&quot;module&quot;</span><span class="o">:</span> <span class="s2">&quot;PowerLaboratory&quot;</span><span class="p">,</span>
<span class="linenos"> 5</span>        <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos"> 6</span>            <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos"> 7</span>                <span class="s2">&quot;max_current&quot;</span><span class="o">:</span> <span class="mf">16</span><span class="p">,</span>
<span class="linenos"> 8</span>            <span class="p">}</span>
<span class="linenos"> 9</span>        <span class="p">}</span>
<span class="linenos">10</span>    <span class="p">},</span>
<span class="linenos">11</span>    <span class="s2">&quot;power&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos">12</span>        <span class="s2">&quot;module&quot;</span><span class="o">:</span> <span class="s2">&quot;Power&quot;</span><span class="p">,</span>
<span class="linenos">13</span>        <span class="s2">&quot;connections&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos">14</span>            <span class="s2">&quot;powerin&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos">15</span>                <span class="s2">&quot;module_id&quot;</span><span class="o">:</span> <span class="s2">&quot;powerlab&quot;</span><span class="p">,</span>
<span class="linenos">16</span>                <span class="s2">&quot;unit_id&quot;</span><span class="o">:</span> <span class="s2">&quot;main&quot;</span>
<span class="linenos">17</span>            <span class="p">},</span>
<span class="linenos">18</span>            <span class="s2">&quot;optional:solar&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos">19</span>                <span class="s2">&quot;module_id&quot;</span><span class="o">:</span> <span class="s2">&quot;solar&quot;</span><span class="p">,</span>
<span class="linenos">20</span>                <span class="s2">&quot;unit_id&quot;</span><span class="o">:</span> <span class="s2">&quot;main&quot;</span>
<span class="linenos">21</span>            <span class="p">}</span>
<span class="linenos">22</span>        <span class="p">}</span>
<span class="linenos">23</span>    <span class="p">},</span>
<span class="linenos">24</span>    <span class="s2">&quot;solar&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos">25</span>        <span class="s2">&quot;module&quot;</span><span class="o">:</span> <span class="s2">&quot;PowerSolar&quot;</span><span class="p">,</span>
<span class="linenos">26</span>        <span class="s2">&quot;config&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos">27</span>            <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos">28</span>                <span class="s2">&quot;max_current&quot;</span><span class="o">:</span> <span class="mf">16</span><span class="p">,</span>
<span class="linenos">29</span>            <span class="p">}</span>
<span class="linenos">30</span>        <span class="p">}</span>
<span class="linenos">31</span>    <span class="p">}</span>
<span class="linenos">32</span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">How To: Develop New Modules</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#new-directory">1. New directory</a></li>
<li><a class="reference internal" href="#creating-the-essential-files">2. Creating the essential files</a></li>
<li><a class="reference internal" href="#define-the-init-py">4. Define the __init__.py</a></li>
<li><a class="reference internal" href="#define-the-manifest-json">5. Define the manifest.json</a></li>
<li><a class="reference internal" href="#creating-a-unit-script">5. Creating a unit-script</a><ul>
<li><a class="reference internal" href="#exercise">Exercise</a></li>
</ul>
</li>
<li><a class="reference internal" href="#connecting-modules">5. Connecting Modules</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/doc_tutorial_1_develop_new_modules.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">EVerest  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">How To: Develop New Modules</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Pionix GmbH.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.1.
    </div>
  </body>
</html>